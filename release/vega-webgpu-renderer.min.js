!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-scenegraph"),require("d3-color")):"function"==typeof define&&define.amd?define(["exports","vega-scenegraph","d3-color"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).WevGPURenderer={},e.vega,e.d3)}(this,function(u,f,c){"use strict";function q(e,s,a,u){return new(a=a||Promise)(function(n,t){function r(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}o((u=u.apply(e,s||[])).next())})}function N(r,i){var o,s,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},c={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function e(n){return function(e){var t=[n,e];if(o)throw new TypeError("Generator is already executing.");for(;u=c&&t[c=0]?0:u;)try{if(o=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,s=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3]))u.label=t[1];else if(6===t[0]&&u.label<a[1])u.label=a[1],a=t;else{if(!(a&&u.label<a[2])){a[2]&&u.ops.pop(),u.trys.pop();continue}u.label=a[2],u.ops.push(t)}}t=i.call(r,u)}catch(e){t=[6,e],s=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function v(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}e.prototype.calculateLayouts=function(e){var r=[],i=0,t="vertex"===e?this.vertexFormats:this.instanceFormats,o="vertex"===e?this.vertexLocationOffset:this.instanceLocationOffset;return t.forEach(function(e,t){var n=function(e){switch(e){case"float16x2":return 4;case"float16x4":return 8;case"float32":return Float32Array.BYTES_PER_ELEMENT;case"float32x2":return 2*Float32Array.BYTES_PER_ELEMENT;case"float32x3":return 3*Float32Array.BYTES_PER_ELEMENT;case"float32x4":return 4*Float32Array.BYTES_PER_ELEMENT;case"sint8x2":case"snorm8x2":return 2*Int8Array.BYTES_PER_ELEMENT;case"sint8x4":case"snorm8x4":return 4*Int8Array.BYTES_PER_ELEMENT;case"sint16x2":case"snorm16x2":return 2*Int16Array.BYTES_PER_ELEMENT;case"sint16x4":case"snorm16x4":return 4*Int16Array.BYTES_PER_ELEMENT;case"sint32":return Int32Array.BYTES_PER_ELEMENT;case"sint32x2":return 2*Int32Array.BYTES_PER_ELEMENT;case"sint32x3":return 3*Int32Array.BYTES_PER_ELEMENT;case"sint32x4":return 4*Int32Array.BYTES_PER_ELEMENT;case"uint32":return Uint32Array.BYTES_PER_ELEMENT;case"uint32x2":return 2*Uint32Array.BYTES_PER_ELEMENT;case"uint32x3":return 3*Uint32Array.BYTES_PER_ELEMENT;case"uint32x4":return 4*Uint32Array.BYTES_PER_ELEMENT;case"uint8x2":case"unorm8x2":return 2*Uint8Array.BYTES_PER_ELEMENT;case"uint8x4":case"unorm8x4":return 4*Uint8Array.BYTES_PER_ELEMENT;case"uint16x2":case"unorm16x2":return 2*Uint16Array.BYTES_PER_ELEMENT;case"uint16x4":case"unorm16x4":return 4*Uint16Array.BYTES_PER_ELEMENT;case"unorm10-10-10-2":return 4;default:return 0}}(e);0<n?(r.push({shaderLocation:t+o,offset:i,format:e}),i+=n):console.error("Unsupported format: ".concat(e))}),{arrayStride:i,stepMode:e,attributes:r}},e.prototype.calculateLength=function(e){var e="vertex"===e?this.vertexFormats:this.instanceFormats,n=0;return e.forEach(function(e,t){n+=function(e){switch(e){case"float32":case"uint32":case"sint32":return 1;case"uint8x2":case"sint8x2":case"unorm8x2":case"snorm8x2":case"uint16x2":case"sint16x2":case"unorm16x2":case"snorm16x2":case"float16x2":case"float32x2":case"uint32x2":case"sint32x2":return 2;case"float32x3":case"uint32x3":case"sint32x3":return 3;case"uint8x4":case"sint8x4":case"unorm8x4":case"snorm8x4":case"uint16x4":case"sint16x4":case"unorm16x4":case"snorm16x4":case"float16x4":case"float32x4":case"uint32x4":case"sint32x4":return 4;default:return 0}}(e)}),n},e.prototype.setDirty=function(){this.dirtyFlag=!0},e.prototype.pushFormat=function(e,t){("vertex"===e?this.vertexFormats:this.instanceFormats).push(t),this.setDirty()},e.prototype.pushFormats=function(e,t){e="vertex"===e?this.vertexFormats:this.instanceFormats;e.push.apply(e,v([],g(t),!1)),this.setDirty()},e.prototype.clear=function(){this.vertexFormats=[],this.instanceFormats=[],this.vertexLayout=null,this.instanceLayout=null,this.setDirty()},e.prototype.process=function(){this.dirtyFlag&&(this.vertexLayout=this.calculateLayouts("vertex"),this.instanceLayout=this.calculateLayouts("instance"),this.vertexLength=this.calculateLength("vertex"),this.instanceLength=this.calculateLength("instance"),this.dirtyFlag=!1)},e.prototype.getBuffers=function(){this.process();var e=[];return this.vertexLength&&this.vertexLayout&&e.push(this.vertexLayout),this.instanceLength&&this.instanceLayout&&e.push(this.instanceLayout),e},e.prototype.getVertexBuffer=function(){return this.process(),this.vertexLayout},e.prototype.getInstanceBuffer=function(){return this.process(),this.instanceLayout},e.prototype.getVertexLength=function(){return this.process(),this.vertexLength},e.prototype.getInstanceLength=function(){return this.process(),this.instanceLength};var p=e;function e(e,t,n,r){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),this.vertexFormats=[],this.instanceFormats=[],this.vertexLayout=null,this.instanceLayout=null,this.vertexLength=null,this.instanceLength=null,this.dirtyFlag=!0,this.vertexLocationOffset=0|n,this.instanceLocationOffset=r|n+e.length,this.vertexFormats=e,this.instanceFormats=t}t.prototype.createUniformBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),e=null!=e?e:new Float32Array(v(v([],g(this.resolution),!1),g(this.offset),!1)),this.createBuffer(this.bufferName+" Uniform Buffer",e,t)},t.prototype.createGeometryBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),this.createBuffer(this.bufferName+" Geometry Buffer",e,t)},t.prototype.createInstanceBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),this.createBuffer(this.bufferName+" Instance Buffer",e,t)},t.prototype.createVertexBuffer=function(e,t){return void 0===t&&(t=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST),this.createBuffer(this.bufferName+" Vertex Buffer",e,t)},t.prototype.createFrameBuffer=function(e,t){void 0===t&&(t=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE);e={name:this.bufferName+" Frame Buffer",size:e,usage:t,mappedAtCreation:!0},t=this.device.createBuffer(e);return t.unmap(),t},t.prototype.createBuffer=function(e,t,n){var r,e={label:e,size:t.byteLength+3&-4,usage:n,mappedAtCreation:!0},n=this.device.createBuffer(e);return t instanceof Uint16Array&&(r=new Uint16Array(n.getMappedRange())),t instanceof Uint32Array&&(r=new Uint32Array(n.getMappedRange())),(r=t instanceof Float32Array?new Float32Array(n.getMappedRange()):r).set(t),n.unmap(),n},t.prototype.getDevice=function(){return this.device},t.prototype.getBufferName=function(){return this.bufferName},t.prototype.getResolution=function(){return this.resolution},t.prototype.getOffset=function(){return this.offset},t.prototype.setDevice=function(e){this.device=e},t.prototype.setBufferName=function(e){this.bufferName=e},t.prototype.setResolution=function(e){this.resolution=e},t.prototype.setOffset=function(e){this.offset=e};var x=t;function t(e,t,n,r){this.bufferName="Unknown",this.device=e||null,this.bufferName=t||"Unknown",this.resolution=n||[0,0],this.offset=r||[0,0]}a.queue2=function(e,t,n,r,i,o,s){return a.render({device:e,pipeline:t,renderPassDescriptor:n,drawCounts:r,vertexBuffers:i,bindGroups:o},s=void 0===s?!0:s)},a.render=function(e,t){void 0===t&&(t=!0);var n,r=e,e=r.device.createCommandEncoder(),i=e.beginRenderPass(r.renderPassDescriptor);i.setPipeline(r.pipeline);for(var o=0;o<r.vertexBuffers.length;o++)i.setVertexBuffer(o,r.vertexBuffers[o]);for(o=0;o<r.bindGroups.length;o++)i.setBindGroup(o,r.bindGroups[o]);if(r.drawCounts instanceof Array?i.draw(r.drawCounts[0],null!=(n=r.drawCounts[0])?n:1,null!=(n=r.drawCounts[0])?n:0,null!=(n=r.drawCounts[0])?n:0):i.draw(r.drawCounts.vertexCount,null!=(n=r.drawCounts.instanceCount)?n:1,null!=(n=r.drawCounts.firstVertex)?n:0,null!=(n=r.drawCounts.firstInstance)?n:0),i.end(),!t)return e.finish();r.device.queue.submit([e.finish()])},a.queue2=function(e,t,n,r,i,o){a.queue({device:e,pipeline:t,renderPassDescriptor:n,drawCounts:r,vertexBuffers:i,bindGroups:o})},a.queue=function(e){a._queue.push(e)},a.clearQueue=function(){a._queue=[]},a.submitQueue=function(e){for(var t=[],n=0;n<a._queue.length;n++){var r=a._queue[n];e?t.push(a.render(r,!1)):a.render(r)}e&&e.queue.submit(t)},a.createRenderPipeline=function(e,t,n,r,i,o){return t.createRenderPipeline({label:e+" Render Pipeline",layout:null!=o?o:"auto",vertex:{module:n,entryPoint:"main_vertex",buffers:i},fragment:{module:n,entryPoint:"main_fragment",targets:[{format:r,blend:{alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth24plus",depthCompare:"less-equal",depthWriteEnabled:!0}})},a.createPipelineLayout=function(e,t,n){return t.createPipelineLayout({label:e+" Pipeline Layout",bindGroupLayouts:n})},a.createUniformBindGroupLayout=function(e,t){return t.createBindGroupLayout({label:e+" Uniform Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]})},a.createUniformBindGroup=function(e,t,n,r,i){return t.createBindGroup({label:e+" Uniform Bind Group",layout:n.getBindGroupLayout(i=void 0===i?0:i),entries:[{binding:i,resource:{buffer:r}}]})},a.createBindGroup=function(e,t,n,r,i,o){void 0===o&&(o=0);for(var s=[],a=0;a<r.length;a++)s.push({binding:a,resource:{buffer:r[a]}});return t.createBindGroup({label:e+" Custom Bind Group",layout:null!=i?i:n.getBindGroupLayout(o),entries:s})},a.createBindGroupLayout=function(e,t,n){for(var r=[],i=0;i<n.length;i++)r.push({binding:i,visibility:n[i].visibility,buffer:n[i].buffer});return t.createBindGroupLayout({label:e+" Custom Bind Group Layout",entries:r})},a.createRenderPassDescriptor=function(e,t,n){return{label:e+" Render Pass Descriptor",colorAttachments:[{view:void 0,clearValue:t,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:n,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}},a._queue=[];var m=a;function a(){}function F(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var G={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},V=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var z=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;var H=F(function(e){var i=[];return e.replace(V,function(e,t,n){var r=t.toLowerCase();for(n=function(e){e=e.match(z);return e?e.map(Number):[]}(n),"m"==r&&2<n.length&&(i.push([t].concat(n.splice(0,2))),r="l",t="m"==t?"l":"L");;){if(n.length==G[r])return n.unshift(t),i.push(n);if(n.length<G[r])throw new Error("malformed path data");i.push([t].concat(n.splice(0,G[r])))}}),i}),n={exports:{}};var $=function(e,t){if(e.length<=1)return e;for(var n,r,i,o,s=(t="number"==typeof t?t:1)*t,a=e[0],u=[a],c=1,l=e.length;c<l;c++)n=e[c],i=a,o=void 0,o=(r=n)[0]-i[0],r=r[1]-i[1],s<o*o+r*r&&(u.push(n),a=n);return a!==n&&u.push(n),u},W=function(e,t){var n;return e.length<=1?e:(function e(t,n,r,i,o){for(var s,a,u,c,l,f,h,d=i,p=n+1;p<r;p++){a=t[p],u=t[n],g=t[r],h=f=l=c=void 0,l=u[0],u=u[1],f=g[0]-l,h=g[1]-u,0==f&&0==h||(1<(c=((a[0]-l)*f+(a[1]-u)*h)/(f*f+h*h))?(l=g[0],u=g[1]):0<c&&(l+=f*c,u+=h*c));var g=(f=a[0]-l)*f+(h=a[1]-u)*h;d<g&&(s=p,d=g)}i<d&&(1<s-n&&e(t,n,s,i,o),o.push(t[s]),1<r-s)&&e(t,s,r,i,o)}(e,0,n=e.length-1,(t="number"==typeof t?t:1)*t,t=[e[0]]),t.push(e[n]),t)};n.exports=function(e,t){return e=$(e,t),e=W(e,t)},n.exports.radialDistance=$,n.exports.douglasPeucker=W;var Y=F(n.exports);function j(e){return[e[0],e[1]]}function Q(e,t,n,r,i,o){var s,a,u,c,l,f,i=J/(i="number"==typeof i?i:1);return t=t,n=n,r=r,i=i*=i,(s=o=o||[]).push(j(e=e)),a=e[0],e=e[1],u=t[0],t=t[1],c=n[0],n=n[1],l=r[0],f=r[1],function e(t,n,r,i,o,s,a,u,c,l,f){if(Z<f)return;var h=Math.PI;var d=(t+r)/2;var p=(n+i)/2;var g=(r+o)/2;var v=(i+s)/2;var x=(o+a)/2;var m=(s+u)/2;var y=(d+g)/2;var _=(p+v)/2;g=(g+x)/2;v=(v+m)/2;var w=(y+g)/2;var E=(_+v)/2;if(0<f){var O,b=a-t,L=u-n,S=Math.abs((r-a)*L-(i-u)*b),R=Math.abs((o-a)*L-(s-u)*b);if(X<S&&X<R){if((S+R)*(S+R)<=l*(b*b+L*L)){if(k<K)return void c.push([w,E]);var U=Math.atan2(s-i,o-r);if(O=Math.abs(U-Math.atan2(i-n,r-t)),U=Math.abs(Math.atan2(u-s,a-o)-U),(O=h<=O?2*h-O:O)+(U=h<=U?2*h-U:U)<k)return void c.push([w,E]);if(0!==B){if(B<O)return void c.push([r,i]);if(B<U)return void c.push([o,s])}}}else if(X<S){if(S*S<=l*(b*b+L*L)){if(k<K)return void c.push([w,E]);if(O=Math.abs(Math.atan2(s-i,o-r)-Math.atan2(i-n,r-t)),(O=h<=O?2*h-O:O)<k)return c.push([r,i]),void c.push([o,s]);if(0!==B&&B<O)return void c.push([r,i])}}else if(X<R){if(R*R<=l*(b*b+L*L)){if(k<K)return void c.push([w,E]);if(O=Math.abs(Math.atan2(u-s,a-o)-Math.atan2(s-i,o-r)),(O=h<=O?2*h-O:O)<k)return c.push([r,i]),void c.push([o,s]);if(0!==B&&B<O)return void c.push([o,s])}}else if((b=w-(t+a)/2)*b+(L=E-(n+u)/2)*L<=l)return void c.push([w,E])}e(t,n,d,p,y,_,w,E,c,l,f+1);e(w,E,g,v,x,m,a,u,c,l,f+1)}(a,e,u,t,c,n,l,f,s,i,0),s.push(j(r)),o}var Z,X,J,K,k,B;Z="number"==typeof(i=i||{}).recursion?i.recursion:8,X="number"==typeof i.epsilon?i.epsilon:1.1920929e-7,J="number"==typeof i.pathEpsilon?i.pathEpsilon:1,K="number"==typeof i.angleEpsilon?i.angleEpsilon:.01,k=i.angleTolerance||0,B=i.cuspLimit||0;var O=Math.PI,ee=ie(120);function te(e,t,n,r){return["C",e,t,n,r,n,r]}function ne(e,t,n,r,i,o){return["C",e/3+2/3*n,t/3+2/3*r,i/3+2/3*n,o/3+2/3*r,i,o]}function re(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}function ie(e){return e*(O/180)}var oe=Q,se=function(e){var i=0,o=0,s=0,a=0;return e.map(function(e){var t=(e=e.slice())[0],n=t.toUpperCase();if(t!=n)switch(e[0]=n,t){case"a":e[6]+=s,e[7]+=a;break;case"v":e[1]+=a;break;case"h":e[1]+=s;break;default:for(var r=1;r<e.length;)e[r++]+=s,e[r++]+=a}switch(n){case"Z":s=i,a=o;break;case"H":s=e[1];break;case"V":a=e[1];break;case"M":s=i=e[1],a=o=e[2];break;default:s=e[e.length-2],a=e[e.length-1]}return e})},ae=function(e){for(var t,n=[],r=0,i=0,o=0,s=0,a=null,u=null,c=0,l=0,f=0,h=e.length;f<h;f++){var d=e[f],p=d[0];switch(p){case"M":o=d[1],s=d[2];break;case"A":(d=function e(t,n,r,i,o,s,a,u,c,l){{var f,h,d,p;l?(d=l[0],p=l[1],f=l[2],h=l[3]):(y=re(t,n,-o),t=y.x,n=y.y,y=re(u,c,-o),u=y.x,c=y.y,1<(g=(y=(t-u)/2)*y/(r*r)+(x=(n-c)/2)*x/(i*i))&&(g=Math.sqrt(g),r*=g,i*=g),g=r*r,v=i*i,s=(s==a?-1:1)*Math.sqrt(Math.abs((g*v-g*x*x-v*y*y)/(g*x*x+v*y*y))),f=(s=s==1/0?1:s)*r*x/i+(t+u)/2,h=s*-i*y/r+(n+c)/2,d=Math.asin(((n-h)/i).toFixed(9)),p=Math.asin(((c-h)/i).toFixed(9)),(d=t<f?O-d:d)<0&&(d=2*O+d),(p=u<f?O-p:p)<0&&(p=2*O+p),a&&p<d&&(d-=2*O),!a&&d<p&&(p-=2*O))}{var g,v,x,m;Math.abs(p-d)>ee&&(g=p,v=u,x=c,p=d+ee*(a&&d<p?1:-1),u=f+r*Math.cos(p),c=h+i*Math.sin(p),m=e(u,c,r,i,o,0,a,v,x,[p,g,f,h]))}s=Math.tan((p-d)/4);var y=4/3*r*s;a=4/3*i*s;var _=[2*t-(t+y*Math.sin(d)),2*n-(n-a*Math.cos(d)),u+y*Math.sin(p),c-a*Math.cos(p),u,c];if(l)return _;m&&(_=_.concat(m));for(var w=0;w<_.length;){var E=re(_[w],_[w+1],o);_[w++]=E.x,_[w++]=E.y}return _}(c,l,d[1],d[2],ie(d[3]),d[4],d[5],d[6],d[7])).unshift("C"),7<d.length&&(n.push(d.splice(0,7)),d.unshift("C"));break;case"S":var g=c,v=l;"C"!=t&&"S"!=t||(g+=g-r,v+=v-i),d=["C",g,v,d[1],d[2],d[3],d[4]];break;case"T":u="Q"==t||"T"==t?(a=2*c-a,2*l-u):(a=c,l),d=ne(c,l,a,u,d[1],d[2]);break;case"Q":a=d[1],u=d[2],d=ne(c,l,d[1],d[2],d[3],d[4]);break;case"L":d=te(c,l,d[1],d[2]);break;case"H":d=te(c,l,d[1],l);break;case"V":d=te(c,l,c,d[1]);break;case"Z":d=te(c,l,o,s)}t=p,c=d[d.length-2],l=d[d.length-1],i=4<d.length?(r=d[d.length-4],d[d.length-3]):(r=c,l),n.push(d)}return n},ue=function(e,t){return e[0]=t[0],e[1]=t[1],e};function ce(e,t,n){return e[0]=t,e[1]=n,e}var le=[0,0],fe=[0,0],he=[0,0];function d(e){if(!e)throw"Assertion Failed!"}var de=F(function(e,s){var a=[],u=[],c=[0,0];return ae(se(e)).forEach(function(e,t,n){if("M"===e[0])ue(c,e.slice(1)),0<u.length&&(a.push(u),u=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);r=u,i=s,oe(c,ce(le,(o=e)[1],o[2]),ce(fe,o[3],o[4]),ce(he,o[5],o[6]),i,r),ce(c,e[5],e[6])}var r,i,o}),0<u.length&&a.push(u),a}),y={},n=y;y.WINDING_ODD=0,y.WINDING_NONZERO=1,y.WINDING_POSITIVE=2,y.WINDING_NEGATIVE=3,y.WINDING_ABS_GEQ_TWO=4,y.POLYGONS=0,y.CONNECTED_POLYGONS=1,y.BOUNDARY_CONTOURS=2,y.tesselate=function(e){for(var t=e.debug||!1,n=new Oe,r=0;r<e.contours.length;r++)n.addContour(e.vertexSize||2,e.contours[r]);return n.tesselate(e.windingRule||y.WINDING_ODD,e.elementType||y.POLYGONS,e.polySize||3,e.vertexSize||2,e.normal||[0,0,1]),{vertices:n.vertices,vertexIndices:n.vertexIndices,vertexCount:n.vertexCount,elements:n.elements,elementCount:n.elementCount,mesh:t?n.mesh:void 0}};function h(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function pe(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function ge(e){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=e}function ve(){var e=new h,t=new pe,n=new ge(0),r=new ge(1);(e.next=e.prev=e).anEdge=null,(t.next=t.prev=t).anEdge=null,t.trail=null,t.marked=!1,t.inside=!1,(n.next=n).Sym=r,n.Onext=null,n.Lnext=null,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,(r.next=r).Sym=n,r.Onext=null,r.Lnext=null,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,this.vHead=e,this.fHead=t,this.eHead=n,this.eHeadSym=r}ge.prototype={get Rface(){return this.Sym.Lface},set Rface(e){this.Sym.Lface=e},get Dst(){return this.Sym.Org},set Dst(e){this.Sym.Org=e},get Oprev(){return this.Sym.Lnext},set Oprev(e){this.Sym.Lnext=e},get Lprev(){return this.Onext.Sym},set Lprev(e){this.Onext.Sym=e},get Dprev(){return this.Lnext.Sym},set Dprev(e){this.Lnext.Sym=e},get Rprev(){return this.Sym.Onext},set Rprev(e){this.Sym.Onext=e},get Dnext(){return this.Sym.Onext.Sym},set Dnext(e){this.Sym.Onext.Sym=e},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(e){this.Sym.Lnext.Sym=e}},ve.prototype={makeEdge_:function(e){var t=new ge(0),n=new ge(1),r=(e=e.Sym.side<e.side?e.Sym:e).Sym.next;return(((n.next=r).Sym.next=t).next=e).Sym.next=n,t.Sym=n,(t.Onext=t).Lnext=n,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,n.Sym=t,(n.Onext=n).Lnext=t,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,t},splice_:function(e,t){var n=e.Onext,r=t.Onext;n.Sym.Lnext=t,(r.Sym.Lnext=e).Onext=r,t.Onext=n},makeVertex_:function(e,t,n){for(var r=e,e=(d(null!==r),n.prev),i=((((r.prev=e).next=r).next=n).prev=r).anEdge=t;i.Org=r,(i=i.Onext)!==t;);},makeFace_:function(e,t,n){for(var r=e,e=(d(null!==r),n.prev),i=(((((r.prev=e).next=r).next=n).prev=r).anEdge=t,r.trail=null,r.marked=!1,r.inside=n.inside,t);i.Lface=r,(i=i.Lnext)!==t;);},killEdge_:function(e){var t=(e=e.Sym.side<e.side?e.Sym:e).next,e=e.Sym.next;(t.Sym.next=e).Sym.next=t},killVertex_:function(e,t){for(var n=e.anEdge,r=n;r.Org=t,(r=r.Onext)!==n;);var i=e.prev,e=e.next;(e.prev=i).next=e},killFace_:function(e,t){for(var n=e.anEdge,r=n;r.Lface=t,(r=r.Lnext)!==n;);var i=e.prev,e=e.next;(e.prev=i).next=e},makeEdge:function(){var e=new h,t=new h,n=new pe,r=this.makeEdge_(this.eHead);return this.makeVertex_(e,r,this.vHead),this.makeVertex_(t,r.Sym,this.vHead),this.makeFace_(n,r,this.fHead),r},splice:function(e,t){var n=!1,r=!1;e===t||(t.Org!==e.Org&&(r=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),r||(r=new h,this.makeVertex_(r,t,e.Org),e.Org.anEdge=e),n)||(r=new pe,this.makeFace_(r,t,e.Lface),e.Lface.anEdge=e)},delete:function(e){var t=e.Sym,n=!1;e.Lface!==e.Rface&&(n=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e?this.killVertex_(e.Org,null):(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),n||(n=new pe,this.makeFace_(n,e,e.Lface))),t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},addEdgeVertex:function(e){var t=this.makeEdge_(e),n=t.Sym,r=(this.splice_(t,e.Lnext),t.Org=e.Dst,new h);return this.makeVertex_(r,n,t.Org),t.Lface=n.Lface=e.Lface,t},splitEdge:function(e,t){var n=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,n),e.Dst=n.Org,n.Dst.anEdge=n.Sym,n.Rface=e.Rface,n.winding=e.winding,n.Sym.winding=e.Sym.winding,n},connect:function(e,t){var n=!1,r=this.makeEdge_(e),i=r.Sym;return t.Lface!==e.Lface&&(n=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(r,e.Lnext),this.splice_(i,t),r.Org=e.Dst,i.Org=t.Org,r.Lface=i.Lface=e.Lface,e.Lface.anEdge=i,n||(t=new pe,this.makeFace_(t,r,e.Lface)),r},zapFace:function(e){for(var t,n,r,i=e.anEdge,o=i.Lnext;o=(t=o).Lnext,(t.Lface=null)===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(n=t.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(t)),t!=i;);r=e.prev,((e=e.next).prev=r).next=e},countFaceVerts_:function(e){for(var t=e.anEdge,n=0;n++,(t=t.Lnext)!==e.anEdge;);return n},mergeConvexFaces:function(e){for(var t,n,r,i,o=this.fHead.next;o!==this.fHead;o=o.next)if(o.inside)for(i=(t=o.anEdge).Org;;){if(n=t.Lnext,(r=t.Sym)&&r.Lface&&r.Lface.inside&&this.countFaceVerts_(o)+this.countFaceVerts_(r.Lface)-2<=e&&_.vertCCW(t.Lprev.Org,t.Org,r.Lnext.Lnext.Org)&&_.vertCCW(r.Lprev.Org,r.Org,t.Lnext.Lnext.Org)&&(n=r.Lnext,this.delete(r),t=null),t&&t.Lnext.Org===i)break;t=n}return!0},check:function(){var e,t,n,r,i,o=this.fHead,s=this.vHead,a=this.eHead,u=o;for(u=o;(e=u.next)!==o;u=e)for(d(e.prev===u),r=e.anEdge;d(r.Sym!==r),d(r.Sym.Sym===r),d(r.Lnext.Onext.Sym===r),d(r.Onext.Sym.Lnext===r),d(r.Lface===e),(r=r.Lnext)!==e.anEdge;);for(d(e.prev===u&&null===e.anEdge),n=n=s;(t=n.next)!==s;n=t)for(d(t.prev===n),r=t.anEdge;d(r.Sym!==r),d(r.Sym.Sym===r),d(r.Lnext.Onext.Sym===r),d(r.Onext.Sym.Lnext===r),d(r.Org===t),(r=r.Onext)!==t.anEdge;);for(d(t.prev===n&&null===t.anEdge),i=i=a;(r=i.next)!==a;i=r)d(r.Sym.next===i.Sym),d(r.Sym!==r),d(r.Sym.Sym===r),d(null!==r.Org),d(null!==r.Dst),d(r.Lnext.Onext.Sym===r),d(r.Onext.Sym.Lnext===r);d(r.Sym.next===i.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)}};var _={};function xe(){this.key=null,this.next=null,this.prev=null}function me(e,t){this.head=new xe,this.head.next=this.head,this.head.prev=this.head,this.frame=e,this.leq=t}function ye(){this.handle=null}function _e(){this.key=null,this.node=null}function we(e,t){this.size=0,this.max=e,this.nodes=[],this.nodes.length=e+1;for(var n=0;n<this.nodes.length;n++)this.nodes[n]=new ye;this.handles=[],this.handles.length=e+1;for(n=0;n<this.handles.length;n++)this.handles[n]=new _e;this.initialized=!1,this.freeList=0,this.leq=t,this.nodes[1].handle=1,this.handles[1].key=null}function Ee(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}_.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},_.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},_.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},_.edgeGoesLeft=function(e){return _.vertLeq(e.Dst,e.Org)},_.edgeGoesRight=function(e){return _.vertLeq(e.Org,e.Dst)},_.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},_.edgeEval=function(e,t,n){d(_.vertLeq(e,t)&&_.vertLeq(t,n));var r=t.s-e.s,i=n.s-t.s;return 0<r+i?r<i?t.t-e.t+(e.t-n.t)*(r/(r+i)):t.t-n.t+(n.t-e.t)*(i/(r+i)):0},_.edgeSign=function(e,t,n){d(_.vertLeq(e,t)&&_.vertLeq(t,n));var r=t.s-e.s,i=n.s-t.s;return 0<r+i?(t.t-n.t)*r+(t.t-e.t)*i:0},_.transEval=function(e,t,n){d(_.transLeq(e,t)&&_.transLeq(t,n));var r=t.t-e.t,i=n.t-t.t;return 0<r+i?r<i?t.s-e.s+(e.s-n.s)*(r/(r+i)):t.s-n.s+(n.s-e.s)*(i/(r+i)):0},_.transSign=function(e,t,n){d(_.transLeq(e,t)&&_.transLeq(t,n));var r=t.t-e.t,i=n.t-t.t;return 0<r+i?(t.s-n.s)*r+(t.s-e.s)*i:0},_.vertCCW=function(e,t,n){return 0<=e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)},_.interpolate=function(e,t,n,r){return(e=e<0?0:e)<=(n=n<0?0:n)?0==n?(t+r)/2:t+e/(e+n)*(r-t):r+n/(e+n)*(t-r)},_.intersect=function(e,t,n,r,i){var o,s,a;_.vertLeq(e,t)||(a=e,e=t,t=a),_.vertLeq(n,r)||(a=n,n=r,r=a),_.vertLeq(e,n)||(a=e,e=n,n=a,a=t,t=r,r=a),_.vertLeq(n,t)?_.vertLeq(t,r)?((o=_.edgeEval(e,n,t))+(s=_.edgeEval(n,t,r))<0&&(o=-o,s=-s),i.s=_.interpolate(o,n.s,s,t.s)):((o=_.edgeSign(e,n,t))+(s=-_.edgeSign(e,r,t))<0&&(o=-o,s=-s),i.s=_.interpolate(o,n.s,s,r.s)):i.s=(n.s+t.s)/2,_.transLeq(e,t)||(a=e,e=t,t=a),_.transLeq(n,r)||(a=n,n=r,r=a),_.transLeq(e,n)||(a=e,e=n,n=a,a=t,t=r,r=a),_.transLeq(n,t)?_.transLeq(t,r)?((o=_.transEval(e,n,t))+(s=_.transEval(n,t,r))<0&&(o=-o,s=-s),i.t=_.interpolate(o,n.t,s,t.t)):((o=_.transSign(e,n,t))+(s=-_.transSign(e,r,t))<0&&(o=-o,s=-s),i.t=_.interpolate(o,n.t,s,r.t)):i.t=(n.t+t.t)/2},me.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(e){return this.insertBefore(this.head,e)},search:function(e){for(var t=this.head;null!==(t=t.next).key&&!this.leq(this.frame,e,t.key););return t},insertBefore:function(e,t){for(;null!==(e=e.prev).key&&!this.leq(this.frame,e.key,t););var n=new xe;return n.key=t,n.next=e.next,((e.next.prev=n).prev=e).next=n},delete:function(e){e.next.prev=e.prev,e.prev.next=e.next}},we.prototype={floatDown_:function(e){for(var t,n,r=this.nodes,i=this.handles,o=r[e].handle;;){if((n=e<<1)<this.size&&this.leq(i[r[n+1].handle].key,i[r[n].handle].key)&&++n,d(n<=this.max),t=r[n].handle,n>this.size||this.leq(i[o].key,i[t].key)){i[r[e].handle=o].node=e;break}i[r[e].handle=t].node=e,e=n}},floatUp_:function(e){for(var t,n,r=this.nodes,i=this.handles,o=r[e].handle;;){if(t=r[n=e>>1].handle,0==n||this.leq(i[t].key,i[o].key)){i[r[e].handle=o].node=e;break}i[r[e].handle=t].node=e,e=n}},init:function(){for(var e=this.size;1<=e;--e)this.floatDown_(e);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){this.size},insert:function(e){var t,n,r=++this.size;if(2*r>this.max){this.max*=2,n=this.nodes.length,this.nodes.length=this.max+1;for(var i=n;i<this.nodes.length;i++)this.nodes[i]=new ye;n=this.handles.length,this.handles.length=this.max+1;for(i=n;i<this.handles.length;i++)this.handles[i]=new _e}return 0===this.freeList?t=r:(t=this.freeList,this.freeList=this.handles[t].node),this.nodes[r].handle=t,this.handles[t].node=r,this.handles[t].key=e,this.initialized&&this.floatUp_(r),t},extractMin:function(){var e=this.nodes,t=this.handles,n=e[1].handle,r=t[n].key;return 0<this.size&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList,this.freeList=n,--this.size,0<this.size)&&this.floatDown_(1),r},delete:function(e){var t,n=this.nodes,r=this.handles;d(1<=e&&e<=this.max&&null!==r[e].key),n[t=r[e].node].handle=n[this.size].handle,r[n[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(r[n[t>>1].handle].key,r[n[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),r[e].key=null,r[e].node=this.freeList,this.freeList=e}};var w={};function Oe(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=y.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}w.regionBelow=function(e){return e.nodeUp.prev.key},w.regionAbove=function(e){return e.nodeUp.next.key},w.debugEvent=function(e){},w.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},w.edgeLeq=function(e,t,n){var e=e.event,t=t.eUp,n=n.eUp;return t.Dst===e?n.Dst===e?_.vertLeq(t.Org,n.Org)?_.edgeSign(n.Dst,t.Org,n.Org)<=0:0<=_.edgeSign(t.Dst,n.Org,t.Org):_.edgeSign(n.Dst,e,n.Org)<=0:n.Dst===e?0<=_.edgeSign(t.Dst,e,t.Org):(t=_.edgeEval(t.Dst,e,t.Org),_.edgeEval(n.Dst,e,n.Org)<=t)},w.deleteRegion=function(e,t){t.fixUpperEdge&&d(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},w.fixUpperEdge=function(e,t,n){d(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,(t.eUp=n).activeRegion=t},w.topLeftRegion=function(e,t){for(var n,r=t.eUp.Org;(t=w.regionAbove(t)).eUp.Org===r;);if(t.fixUpperEdge){if(null===(n=e.mesh.connect(w.regionBelow(t).eUp.Sym,t.eUp.Lnext)))return null;w.fixUpperEdge(e,t,n),t=w.regionAbove(t)}return t},w.topRightRegion=function(e){for(var t=e.eUp.Dst,e=null;(e=w.regionAbove(e)).eUp.Dst===t;);return e},w.addRegionBelow=function(e,t,n){var r=new Ee;return r.eUp=n,r.nodeUp=e.dict.insertBefore(t.nodeUp,r),r.fixUpperEdge=!1,r.sentinel=!1,r.dirty=!1,n.activeRegion=r},w.isWindingInside=function(e,t){switch(e.windingRule){case y.WINDING_ODD:return 0!=(1&t);case y.WINDING_NONZERO:return 0!=t;case y.WINDING_POSITIVE:return 0<t;case y.WINDING_NEGATIVE:return t<0;case y.WINDING_ABS_GEQ_TWO:return 2<=t||t<=-2}return d(!1),!1},w.computeWinding=function(e,t){t.windingNumber=w.regionAbove(t).windingNumber+t.eUp.winding,t.inside=w.isWindingInside(e,t.windingNumber)},w.finishRegion=function(e,t){var n=t.eUp,r=n.Lface;r.inside=t.inside,r.anEdge=n,w.deleteRegion(e,t)},w.finishLeftRegions=function(e,t,n){for(var r,i,o=t,s=t.eUp;o!==n;){if(o.fixUpperEdge=!1,(r=(i=w.regionBelow(o)).eUp).Org!=s.Org){if(!i.fixUpperEdge){w.finishRegion(e,o);break}r=e.mesh.connect(s.Lprev,r.Sym),w.fixUpperEdge(e,i,r)}s.Onext!==r&&(e.mesh.splice(r.Oprev,r),e.mesh.splice(s,r)),w.finishRegion(e,o),s=i.eUp,o=i}return s},w.addRightEdges=function(e,t,n,r,i,o){for(var s,a,u,c=!0,l=n;d(_.vertLeq(l.Org,l.Dst)),w.addRegionBelow(e,t,l.Sym),(l=l.Onext)!==r;);for(a=t,u=i=null===i?w.regionBelow(t).eUp.Rprev:i;(l=(s=w.regionBelow(a)).eUp.Sym).Org===u.Org;)l.Onext!==u&&(e.mesh.splice(l.Oprev,l),e.mesh.splice(u.Oprev,l)),s.windingNumber=a.windingNumber-l.winding,s.inside=w.isWindingInside(e,s.windingNumber),a.dirty=!0,!c&&w.checkForRightSplice(e,a)&&(w.addWinding(l,u),w.deleteRegion(e,a),e.mesh.delete(u)),c=!1,a=s,u=l;a.dirty=!0,d(a.windingNumber-l.winding===s.windingNumber),o&&w.walkDirtyRegions(e,a)},w.spliceMergeVertices=function(e,t,n){e.mesh.splice(t,n)},w.vertexWeights=function(e,t,n){var r=_.vertL1dist(t,e),i=_.vertL1dist(n,e),o=.5*i/(r+i),r=.5*r/(r+i);e.coords[0]+=o*t.coords[0]+r*n.coords[0],e.coords[1]+=o*t.coords[1]+r*n.coords[1],e.coords[2]+=o*t.coords[2]+r*n.coords[2]},w.getIntersectData=function(e,t,n,r,i,o){t.coords[0]=t.coords[1]=t.coords[2]=0,t.idx=-1,w.vertexWeights(t,n,r),w.vertexWeights(t,i,o)},w.checkForRightSplice=function(e,t){var n=w.regionBelow(t),r=t.eUp,i=n.eUp;if(_.vertLeq(r.Org,i.Org)){if(0<_.edgeSign(i.Dst,r.Org,i.Org))return!1;_.vertEq(r.Org,i.Org)?r.Org!==i.Org&&(e.pq.delete(r.Org.pqHandle),w.spliceMergeVertices(e,i.Oprev,r)):(e.mesh.splitEdge(i.Sym),e.mesh.splice(r,i.Oprev),t.dirty=n.dirty=!0)}else{if(_.edgeSign(r.Dst,i.Org,r.Org)<0)return!1;w.regionAbove(t).dirty=t.dirty=!0,e.mesh.splitEdge(r.Sym),e.mesh.splice(i.Oprev,r)}return!0},w.checkForLeftSplice=function(e,t){var n,r=w.regionBelow(t),i=t.eUp,o=r.eUp;if(d(!_.vertEq(i.Dst,o.Dst)),_.vertLeq(i.Dst,o.Dst)){if(_.edgeSign(i.Dst,o.Dst,i.Org)<0)return!1;w.regionAbove(t).dirty=t.dirty=!0,n=e.mesh.splitEdge(i),e.mesh.splice(o.Sym,n),n.Lface.inside=t.inside}else{if(0<_.edgeSign(o.Dst,i.Dst,o.Org))return!1;t.dirty=r.dirty=!0,n=e.mesh.splitEdge(o),e.mesh.splice(i.Lnext,o.Sym),n.Rface.inside=t.inside}return!0},w.checkForIntersect=function(e,t){var n,r=w.regionBelow(t),i=t.eUp,o=r.eUp,s=i.Org,a=o.Org,u=i.Dst,c=o.Dst,l=new h;if(d(!_.vertEq(c,u)),d(_.edgeSign(u,e.event,s)<=0),d(0<=_.edgeSign(c,e.event,a)),d(s!==e.event&&a!==e.event),d(!t.fixUpperEdge&&!r.fixUpperEdge),s!==a&&(n=Math.min(s.t,u.t),!(Math.max(a.t,c.t)<n))){if(_.vertLeq(s,a)){if(0<_.edgeSign(c,s,a))return!1}else if(_.edgeSign(u,a,s)<0)return!1;if(w.debugEvent(e),_.intersect(u,s,c,a,l),d(Math.min(s.t,u.t)<=l.t),d(l.t<=Math.max(a.t,c.t)),d(Math.min(c.s,u.s)<=l.s),d(l.s<=Math.max(a.s,s.s)),_.vertLeq(l,e.event)&&(l.s=e.event.s,l.t=e.event.t),n=_.vertLeq(s,a)?s:a,_.vertLeq(n,l)&&(l.s=n.s,l.t=n.t),_.vertEq(l,s)||_.vertEq(l,a))w.checkForRightSplice(e,t);else{if(!_.vertEq(u,e.event)&&0<=_.edgeSign(u,e.event,l)||!_.vertEq(c,e.event)&&_.edgeSign(c,e.event,l)<=0)return c===e.event?(e.mesh.splitEdge(i.Sym),e.mesh.splice(o.Sym,i),t=w.topLeftRegion(e,t),i=w.regionBelow(t).eUp,w.finishLeftRegions(e,w.regionBelow(t),r),w.addRightEdges(e,t,i.Oprev,i,i,!0),TRUE):u===e.event?(e.mesh.splitEdge(o.Sym),e.mesh.splice(i.Lnext,o.Oprev),r=t,t=w.topRightRegion(t),n=w.regionBelow(t).eUp.Rprev,r.eUp=o.Oprev,o=w.finishLeftRegions(e,r,null),w.addRightEdges(e,t,o.Onext,i.Rprev,n,!0),!0):(0<=_.edgeSign(u,e.event,l)&&(w.regionAbove(t).dirty=t.dirty=!0,e.mesh.splitEdge(i.Sym),i.Org.s=e.event.s,i.Org.t=e.event.t),_.edgeSign(c,e.event,l)<=0&&(t.dirty=r.dirty=!0,e.mesh.splitEdge(o.Sym),o.Org.s=e.event.s,o.Org.t=e.event.t),!1);e.mesh.splitEdge(i.Sym),e.mesh.splitEdge(o.Sym),e.mesh.splice(o.Oprev,i),i.Org.s=l.s,i.Org.t=l.t,i.Org.pqHandle=e.pq.insert(i.Org),w.getIntersectData(e,i.Org,s,u,a,c),w.regionAbove(t).dirty=t.dirty=r.dirty=!0}}return!1},w.walkDirtyRegions=function(e,t){for(var n,r,i=w.regionBelow(t);;){for(;i.dirty;)t=i,i=w.regionBelow(i);if(!t.dirty&&(i=t,null==(t=w.regionAbove(t))||!t.dirty))return;if(t.dirty=!1,n=t.eUp,r=i.eUp,n.Dst!==r.Dst&&w.checkForLeftSplice(e,t)&&(i.fixUpperEdge?(w.deleteRegion(e,i),e.mesh.delete(r),r=(i=w.regionBelow(t)).eUp):t.fixUpperEdge&&(w.deleteRegion(e,t),e.mesh.delete(n),n=(t=w.regionAbove(i)).eUp)),n.Org!==r.Org)if(n.Dst===r.Dst||t.fixUpperEdge||i.fixUpperEdge||n.Dst!==e.event&&r.Dst!==e.event)w.checkForRightSplice(e,t);else if(w.checkForIntersect(e,t))return;n.Org===r.Org&&n.Dst===r.Dst&&(w.addWinding(r,n),w.deleteRegion(e,t),e.mesh.delete(n),t=w.regionAbove(i))}},w.connectRightVertex=function(e,t,n){var r=n.Onext,i=w.regionBelow(t),o=t.eUp,s=i.eUp,a=!1;o.Dst!==s.Dst&&w.checkForIntersect(e,t),_.vertEq(o.Org,e.event)&&(e.mesh.splice(r.Oprev,o),t=w.topLeftRegion(e,t),r=w.regionBelow(t).eUp,w.finishLeftRegions(e,w.regionBelow(t),i),a=!0),_.vertEq(s.Org,e.event)&&(e.mesh.splice(n,s.Oprev),n=w.finishLeftRegions(e,i,null),a=!0),a?w.addRightEdges(e,t,n.Onext,r,r,!0):(i=_.vertLeq(s.Org,o.Org)?s.Oprev:o,i=e.mesh.connect(n.Lprev,i),w.addRightEdges(e,t,i,i.Onext,i.Onext,!1),i.Sym.activeRegion.fixUpperEdge=!0,w.walkDirtyRegions(e,t))},w.connectLeftDegenerate=function(e,t,n){var r,i,o,s,a=t.eUp;_.vertEq(a.Org,n)?(d(!1),w.spliceMergeVertices(e,a,n.anEdge)):_.vertEq(a.Dst,n)?(d(!1),t=w.topRightRegion(t),r=o=(i=(s=w.regionBelow(t)).eUp.Sym).Onext,s.fixUpperEdge&&(d(r!==i),w.deleteRegion(e,s),e.mesh.delete(i),i=r.Oprev),e.mesh.splice(n.anEdge,i),_.edgeGoesLeft(r)||(r=null),w.addRightEdges(e,t,i.Onext,o,r,!0)):(e.mesh.splitEdge(a.Sym),t.fixUpperEdge&&(e.mesh.delete(a.Onext),t.fixUpperEdge=!1),e.mesh.splice(n.anEdge,a),w.sweepEvent(e,n))},w.connectLeftVertex=function(e,t){var n,r,i,o=new Ee;o.eUp=t.anEdge.Sym,o=e.dict.search(o).key,(n=w.regionBelow(o))&&(r=o.eUp,i=n.eUp,0===_.edgeSign(r.Dst,t,r.Org)?w.connectLeftDegenerate(e,o,t):(n=_.vertLeq(i.Dst,r.Dst)?o:n,o.inside||n.fixUpperEdge?(r=n===o?e.mesh.connect(t.anEdge.Sym,r.Lnext):e.mesh.connect(i.Dnext,t.anEdge).Sym,n.fixUpperEdge?w.fixUpperEdge(e,n,r):w.computeWinding(e,w.addRegionBelow(e,o,r)),w.sweepEvent(e,t)):w.addRightEdges(e,o,t.anEdge,t.anEdge,null,!0)))},w.sweepEvent=function(e,t){e.event=t,w.debugEvent(e);for(var n=t.anEdge;null===n.activeRegion;)if((n=n.Onext)==t.anEdge)return void w.connectLeftVertex(e,t);var r=w.topLeftRegion(e,n.activeRegion),i=(d(null!==r),w.regionBelow(r)),o=i.eUp,i=w.finishLeftRegions(e,i,null);i.Onext===o?w.connectRightVertex(e,r,i):w.addRightEdges(e,r,i.Onext,o,o,!0)},w.addSentinel=function(e,t,n,r){var i=new Ee,o=e.mesh.makeEdge();o.Org.s=n,o.Org.t=r,o.Dst.s=t,o.Dst.t=r,e.event=o.Dst,i.eUp=o,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=e.dict.insert(i)},w.initEdgeDict=function(e){e.dict=new me(e,w.edgeLeq);var t=e.bmax[0]-e.bmin[0],n=e.bmax[1]-e.bmin[1],r=e.bmin[0]-t,t=e.bmax[0]+t,i=e.bmin[1]-n,n=e.bmax[1]+n;w.addSentinel(e,r,t,i),w.addSentinel(e,r,t,n)},w.doneEdgeDict=function(e){for(var t,n=0;null!==(t=e.dict.min().key);)t.sentinel||(d(t.fixUpperEdge),d(1==++n)),d(0==t.windingNumber),w.deleteRegion(e,t)},w.removeDegenerateEdges=function(e){for(var t,n,r=e.mesh.eHead,i=r.next;i!==r;i=t)t=i.next,n=i.Lnext,_.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(w.spliceMergeVertices(e,n,i),e.mesh.delete(i),n=(i=n).Lnext),n.Lnext===i&&(n!==i&&(n!==t&&n!==t.Sym||(t=t.next),e.mesh.delete(n)),i!==t&&i!==t.Sym||(t=t.next),e.mesh.delete(i))},w.initPriorityQ=function(e){for(var t,n=0,r=e.mesh.vHead,i=r.next;i!==r;i=i.next)n++;for(t=e.pq=new we(n+=8,_.vertLeq),i=(r=e.mesh.vHead).next;i!==r;i=i.next)i.pqHandle=t.insert(i);return i===r&&(t.init(),!0)},w.donePriorityQ=function(e){e.pq=null},w.removeDegenerateFaces=function(e,t){for(var n,r,i=t.fHead.next;i!==t.fHead;i=n)n=i.next,r=i.anEdge,d(r.Lnext!==r),r.Lnext.Lnext===r&&(w.addWinding(r.Onext,r),e.mesh.delete(r));return!0},w.computeInterior=function(e){var t,n;if(w.removeDegenerateEdges(e),!w.initPriorityQ(e))return!1;for(w.initEdgeDict(e);null!==(t=e.pq.extractMin());){for(;null!==(n=e.pq.min())&&_.vertEq(n,t);)n=e.pq.extractMin(),w.spliceMergeVertices(e,t.anEdge,n.anEdge);w.sweepEvent(e,t)}return e.event=e.dict.min().key.eUp.Org,w.debugEvent(e),w.doneEdgeDict(e),w.donePriorityQ(e),!!w.removeDegenerateFaces(e,e.mesh)&&(e.mesh.check(),!0)},Oe.prototype={dot_:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalize_:function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];d(0<t),t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},longAxis_:function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),t=Math.abs(e[2])>Math.abs(e[t])?2:t},computeNormal_:function(e){for(var t,n,r,i,o,s=[0,0,0],a=[0,0,0],u=[0,0,0],c=[0,0,0],l=[0,0,0],f=[null,null,null],h=[null,null,null],d=this.mesh.vHead,p=d.next,g=0;g<3;++g)r=p.coords[g],a[g]=r,h[g]=p,s[g]=r,f[g]=p;for(p=d.next;p!==d;p=p.next)for(g=0;g<3;++g)(r=p.coords[g])<a[g]&&(a[g]=r,h[g]=p),s[g]<r&&(s[g]=r,f[g]=p);if(s[g=s[g=s[g=0]-a[0]<s[1]-a[1]?1:g]-a[g]<s[2]-a[2]?2:g]<=a[g])e[0]=0,e[1]=0,e[2]=1;else{for(u[o=0]=(t=h[g]).coords[0]-(n=f[g]).coords[0],u[1]=t.coords[1]-n.coords[1],u[2]=t.coords[2]-n.coords[2],p=d.next;p!==d;p=p.next)c[0]=p.coords[0]-n.coords[0],c[1]=p.coords[1]-n.coords[1],c[2]=p.coords[2]-n.coords[2],l[0]=u[1]*c[2]-u[2]*c[1],l[1]=u[2]*c[0]-u[0]*c[2],l[2]=u[0]*c[1]-u[1]*c[0],o<(i=l[0]*l[0]+l[1]*l[1]+l[2]*l[2])&&(o=i,e[0]=l[0],e[1]=l[1],e[2]=l[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(u)]=1)}},checkOrientation_:function(){for(var e,t,n=this.mesh.fHead,r=this.mesh.vHead,i=0,o=n.next;o!==n;o=o.next)if(!((t=o.anEdge).winding<=0))for(;i+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),(t=t.Lnext)!==o.anEdge;);if(i<0){for(e=r.next;e!==r;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var e,t,n,r,i,o=this.mesh.vHead,s=[0,0,0],a=!1;for(s[0]=this.normal[0],s[1]=this.normal[1],s[2]=this.normal[2],0===s[0]&&0===s[1]&&0===s[2]&&(this.computeNormal_(s),a=!0),t=this.sUnit,n=this.tUnit,t[r=this.longAxis_(s)]=0,t[(r+1)%3]=1,t[(r+2)%3]=0,n[r]=0,n[(r+1)%3]=0,n[(r+2)%3]=0<s[r]?1:-1,e=o.next;e!==o;e=e.next)e.s=this.dot_(e.coords,t),e.t=this.dot_(e.coords,n);for(a&&this.checkOrientation_(),i=!0,e=o.next;e!==o;e=e.next)i?(this.bmin[0]=this.bmax[0]=e.s,this.bmin[1]=this.bmax[1]=e.t,i=!1):(e.s<this.bmin[0]&&(this.bmin[0]=e.s),e.s>this.bmax[0]&&(this.bmax[0]=e.s),e.t<this.bmin[1]&&(this.bmin[1]=e.t),e.t>this.bmax[1]&&(this.bmax[1]=e.t))},addWinding_:function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},tessellateMonoRegion_:function(e,t){for(r=t.anEdge,d(r.Lnext!==r&&r.Lnext.Lnext!==r);_.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;_.vertLeq(r.Org,r.Dst);r=r.Lnext);for(n=r.Lprev;r.Lnext!==n;)if(_.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(_.edgeGoesLeft(n.Lnext)||_.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)var n=e.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!=r&&(_.edgeGoesRight(r.Lprev)||0<=_.edgeSign(r.Dst,r.Org,r.Lprev.Org));)var r=e.connect(r,r.Lprev).Sym;r=r.Lnext}for(d(n.Lnext!==r);n.Lnext.Lnext!==r;)n=e.connect(n.Lnext,n).Sym;return!0},tessellateInterior_:function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)if(t=n.next,n.inside&&!this.tessellateMonoRegion_(e,n))return!1;return!0},discardExterior_:function(e){for(var t,n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside||e.zapFace(n)},setWindingNumber_:function(e,t,n){for(var r,i=e.eHead.next;i!==e.eHead;i=r)r=i.next,i.Rface.inside!==i.Lface.inside?i.winding=i.Lface.inside?t:-t:n?e.delete(i):i.winding=0},getNeighbourFace_:function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},outputPolymesh_:function(e,t,n,r){var i,o,s,a,u,c=0,l=0;for(3<n&&e.mergeConvexFaces(n),i=e.vHead.next;i!==e.vHead;i=i.next)i.n=-1;for(h=e.fHead.next;h!=e.fHead;h=h.next)if(h.n=-1,h.inside){for(o=h.anEdge,s=0;-1===(i=o.Org).n&&(i.n=l,l++),s++,(o=o.Lnext)!==h.anEdge;);d(s<=n),h.n=c,++c}for(this.elementCount=c,t==y.CONNECTED_POLYGONS&&(c*=2),this.elements=[],this.elements.length=c*n,this.vertexCount=l,this.vertices=[],this.vertices.length=l*r,this.vertexIndices=[],this.vertexIndices.length=l,i=e.vHead.next;i!==e.vHead;i=i.next)-1!=i.n&&(u=i.n*r,this.vertices[0+u]=i.coords[0],this.vertices[1+u]=i.coords[1],2<r&&(this.vertices[2+u]=i.coords[2]),this.vertexIndices[i.n]=i.idx);for(var f=0,h=e.fHead.next;h!==e.fHead;h=h.next)if(h.inside){for(o=h.anEdge,s=0;i=o.Org,this.elements[f++]=i.n,s++,(o=o.Lnext)!==h.anEdge;);for(a=s;a<n;++a)this.elements[f++]=-1;if(t==y.CONNECTED_POLYGONS){for(o=h.anEdge;this.elements[f++]=this.getNeighbourFace_(o),(o=o.Lnext)!==h.anEdge;);for(a=s;a<n;++a)this.elements[f++]=-1}}},outputContours_:function(e,t){var n,r,i=0,o=0;for(this.vertexCount=0,this.elementCount=0,c=e.fHead.next;c!==e.fHead;c=c.next)if(c.inside){for(r=n=c.anEdge;this.vertexCount++,(n=n.Lnext)!==r;);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;for(var s=0,a=0,u=0,i=0,c=e.fHead.next;c!==e.fHead;c=c.next)if(c.inside){for(o=0,r=n=c.anEdge;this.vertices[s++]=n.Org.coords[0],this.vertices[s++]=n.Org.coords[1],2<t&&(this.vertices[s++]=n.Org.coords[2]),this.vertexIndices[a++]=n.Org.idx,o++,(n=n.Lnext)!==r;);this.elements[u++]=i,i+=this.elements[u++]=o}},addContour:function(e,t){var n,r;for(null===this.mesh&&(this.mesh=new ve),3<(e=e<2?2:e)&&(e=3),n=null,r=0;r<t.length;r+=e)null==n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=t[r+0],n.Org.coords[1]=t[r+1],n.Org.coords[2]=2<e?t[r+2]:0,n.Org.idx=this.vertexIndexCounter++,n.winding=1,n.Sym.winding=-1},tesselate:function(e,t,n,r,i){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,i&&(this.normal[0]=i[0],this.normal[1]=i[1],this.normal[2]=i[2]),this.windingRule=e,3<(r=r<2?2:r)&&(r=3),!this.mesh)return!1;this.projectPolygon_(),w.computeInterior(this);i=this.mesh;return t==y.BOUNDARY_CONTOURS?this.setWindingNumber_(i,1,!0):this.tessellateInterior_(i),i.check(),t==y.BOUNDARY_CONTOURS?this.outputContours_(i,r):this.outputPolymesh_(i,t,n,r),!0}};var be=Object.prototype.hasOwnProperty;var Le=n,Se=function(){for(var e={},t=0;t<arguments.length;t++){var n,r=arguments[t];for(n in r)be.call(r,n)&&(e[n]=r[n])}return e},Re=F(function(e,t){if(t=t||{},0===(e=e.filter(function(e){return 0<e.length})).length)return{positions:[],cells:[]};"number"!=typeof t.vertexSize&&(t.vertexSize=e[0][0].length),e=e.map(function(e){return e.reduce(function(e,t){return e.concat(t)})});for(var n=Le.tesselate(Se({contours:e,windingRule:Le.WINDING_ODD,elementType:Le.POLYGONS,polySize:3,vertexSize:2},t)),r=[],i=0;i<n.vertices.length;i+=t.vertexSize){var o=n.vertices.slice(i,i+t.vertexSize);r.push(o)}for(var s=[],i=0;i<n.elements.length;i+=3){var a=n.elements[i],u=n.elements[i+1],c=n.elements[i+2];s.push([a,u,c])}return{positions:r,cells:s}});function Ue(e,t,n){var r=t;if(n=n||1,!t)return{lines:new Float32Array,triangles:new Float32Array,closed:!1,z:0};var i=(i=de(H(t))).map(function(e){return Y(e,n)});try{p=Re(i)}catch(e){p={positions:[],cells:[]}}for(var o=e._randomZ?.25*(Math.random()-.5):0,s=[],a=p.cells.length,u=p.cells,c=p.positions,l=0;l<a;l++){var f=u[l],h=c[f[0]],d=c[f[1]],f=c[f[2]];s.push(h[0],h[1],o,d[0],d[1],o,f[0],f[1],o)}var p={lines:i,triangles:s,closed:t.endsWith("Z"),z:o,key:r};return e._pathCache[r]=p,e._pathCacheSize++,1e4<e._pathCacheSize&&(e._pathCache={},e._pathCacheSize=0),p}function E(e){return function(){return e}}const ke=Math.abs,U=Math.atan2,C=Math.cos,Be=Math.max,Ce=Math.min,M=Math.sin,D=Math.sqrt,T=1e-12,A=Math.PI,Me=A/2,De=2*A;function Te(e){return 1<=e?Me:e<=-1?-Me:Math.asin(e)}const Ae=Math.PI,Pe=2*Ae,b=1e-6,Ie=Pe-b;function qe(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=arguments[e]+n[e]}class Ne{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?qe:function(e){var t=Math.floor(e);if(!(0<=t))throw new Error("invalid digits: "+e);if(15<t)return qe;const r=10**t;return function(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=Math.round(arguments[e]*r)/r+n[e]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,n,r){this._append`Q${+e},${+t},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(e,t,n,r,i,o){this._append`C${+e},${+t},${+n},${+r},${this._x1=+i},${this._y1=+o}`}arcTo(e,t,n,r,i){if(e=+e,t=+t,n=+n,r=+r,(i=+i)<0)throw new Error("negative radius: "+i);var o,s,a=this._x1,u=this._y1,c=n-e,l=r-t,f=a-e,h=u-t,d=f*f+h*h;null===this._x1?this._append`M${this._x1=e},${this._y1=t}`:d>b&&(Math.abs(h*c-l*f)>b&&i?(s=c*c+l*l,r=(n=n-a)*n+(a=r-u)*a,u=Math.sqrt(s),o=Math.sqrt(d),d=(s=i*Math.tan((Ae-Math.acos((s+d-r)/(2*u*o)))/2))/o,r=s/u,Math.abs(d-1)>b&&this._append`L${e+d*f},${t+d*h}`,this._append`A${i},${i},0,0,${+(f*a<h*n)},${this._x1=e+r*c},${this._y1=t+r*l}`):this._append`L${this._x1=e},${this._y1=t}`)}arc(e,t,n,r,i,o){if(e=+e,t=+t,o=!!o,(n=+n)<0)throw new Error("negative radius: "+n);let s=n*Math.cos(r),a=n*Math.sin(r),u=e+s,c=t+a,l=1^o,f=o?r-i:i-r;null===this._x1?this._append`M${u},${c}`:(Math.abs(this._x1-u)>b||Math.abs(this._y1-c)>b)&&this._append`L${u},${c}`,n&&((f=f<0?f%Pe+Pe:f)>Ie?this._append`A${n},${n},0,1,${l},${e-s},${t-a}A${n},${n},0,1,${l},${this._x1=u},${this._y1=c}`:f>b&&this._append`A${n},${n},0,${+(f>=Ae)},${l},${this._x1=e+n*Math.cos(i)},${this._y1=t+n*Math.sin(i)}`)}rect(e,t,n,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function Fe(n){let r=3;return n.digits=function(e){if(!arguments.length)return r;if(null==e)r=null;else{var t=Math.floor(e);if(!(0<=t))throw new RangeError("invalid digits: "+e);r=t}return n},()=>new Ne(r)}function Ge(e){return e.innerRadius}function Ve(e){return e.outerRadius}function ze(e){return e.startAngle}function He(e){return e.endAngle}function $e(e){return e&&e.padAngle}function We(e,t,n,r,i,o,s){var a=e-n,u=t-r,s=(s?o:-o)/D(a*a+u*u),u=s*u,s=-s*a,a=e+u,e=t+s,t=n+u,n=r+s,r=(a+t)/2,c=(e+n)/2,l=t-a,f=n-e,h=l*l+f*f,o=i-o,a=a*n-t*e,n=(f<0?-1:1)*D(Be(0,o*o*h-a*a)),t=(a*f-l*n)/h,e=(-a*l-f*n)/h,d=(a*f+l*n)/h,a=(-a*l+f*n)/h,l=t-r,f=e-c,n=d-r,h=a-c;return n*n+h*h<l*l+f*f&&(t=d,e=a),{cx:t,cy:e,x01:-u,y01:-s,x11:t*(i/o-1),y11:e*(i/o-1)}}function Ye(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function je(e){this._context=e}function Qe(e){return new je(e)}function Ze(e){return e[0]}function Xe(e){return e[1]}function Je(s,a){var u=E(!0),c=null,l=Qe,f=null,h=Fe(t);function t(e){var t,n,r,i=(e=Ye(e)).length,o=!1;for(null==c&&(f=l(r=h())),t=0;t<=i;++t)!(t<i&&u(n=e[t],t,e))===o&&((o=!o)?f.lineStart():f.lineEnd()),o&&f.point(+s(n,t,e),+a(n,t,e));if(r)return f=null,r+""||null}return s="function"==typeof s?s:void 0===s?Ze:E(s),a="function"==typeof a?a:void 0===a?Xe:E(a),t.x=function(e){return arguments.length?(s="function"==typeof e?e:E(+e),t):s},t.y=function(e){return arguments.length?(a="function"==typeof e?e:E(+e),t):a},t.defined=function(e){return arguments.length?(u="function"==typeof e?e:E(!!e),t):u},t.curve=function(e){return arguments.length?(l=e,null!=c&&(f=l(c)),t):l},t.context=function(e){return arguments.length?(null==e?c=f=null:f=l(c=e),t):c},t}function Ke(l,f,h){var d=null,p=E(!0),g=null,v=Qe,x=null,m=Fe(t);function t(e){var t,n,r,i,o,s=(e=Ye(e)).length,a=!1,u=new Array(s),c=new Array(s);for(null==g&&(x=v(o=m())),t=0;t<=s;++t){if(!(t<s&&p(i=e[t],t,e))===a)if(a=!a)n=t,x.areaStart(),x.lineStart();else{for(x.lineEnd(),x.lineStart(),r=t-1;n<=r;--r)x.point(u[r],c[r]);x.lineEnd(),x.areaEnd()}a&&(u[t]=+l(i,t,e),c[t]=+f(i,t,e),x.point(d?+d(i,t,e):u[t],h?+h(i,t,e):c[t]))}if(o)return x=null,o+""||null}function e(){return Je().defined(p).curve(v).context(g)}return l="function"==typeof l?l:void 0===l?Ze:E(+l),f="function"==typeof f?f:E(void 0===f?0:+f),h="function"==typeof h?h:void 0===h?Xe:E(+h),t.x=function(e){return arguments.length?(l="function"==typeof e?e:E(+e),d=null,t):l},t.x0=function(e){return arguments.length?(l="function"==typeof e?e:E(+e),t):l},t.x1=function(e){return arguments.length?(d=null==e?null:"function"==typeof e?e:E(+e),t):d},t.y=function(e){return arguments.length?(f="function"==typeof e?e:E(+e),h=null,t):f},t.y0=function(e){return arguments.length?(f="function"==typeof e?e:E(+e),t):f},t.y1=function(e){return arguments.length?(h=null==e?null:"function"==typeof e?e:E(+e),t):h},t.lineX0=t.lineY0=function(){return e().x(l).y(f)},t.lineY1=function(){return e().x(l).y(h)},t.lineX1=function(){return e().x(d).y(f)},t.defined=function(e){return arguments.length?(p="function"==typeof e?e:E(!!e),t):p},t.curve=function(e){return arguments.length?(v=e,null!=g&&(x=v(g)),t):v},t.context=function(e){return arguments.length?(null==e?g=x=null:x=v(g=e),t):g},t}je.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var et={draw(e,t){t=D(t/A);e.moveTo(t,0),e.arc(0,0,t,0,De)}};function tt(e){return e.x||0}function nt(e){return e.y||0}function rt(e){return e.width||0}function it(e){return e.height||0}function ot(e){return e.cornerRadius||0}function st(e){return!(!1===e.defined)}at=Ge,ut=Ve,ct=E(0),ft=ze,ht=He,dt=$e,P=lt=null,pt=Fe(r),r.centroid=function(){var e=(+at.apply(this,arguments)+ +ut.apply(this,arguments))/2,t=(+ft.apply(this,arguments)+ +ht.apply(this,arguments))/2-A/2;return[C(t)*e,M(t)*e]},r.innerRadius=function(e){return arguments.length?(at="function"==typeof e?e:E(+e),r):at},r.outerRadius=function(e){return arguments.length?(ut="function"==typeof e?e:E(+e),r):ut},r.cornerRadius=function(e){return arguments.length?(ct="function"==typeof e?e:E(+e),r):ct},r.padRadius=function(e){return arguments.length?(lt=null==e?null:"function"==typeof e?e:E(+e),r):lt},r.startAngle=function(e){return arguments.length?(ft="function"==typeof e?e:E(+e),r):ft},r.endAngle=function(e){return arguments.length?(ht="function"==typeof e?e:E(+e),r):ht},r.padAngle=function(e){return arguments.length?(dt="function"==typeof e?e:E(+e),r):dt},r.context=function(e){return arguments.length?(P=null==e?null:e,r):P};var at,ut,ct,lt,ft,ht,dt,P,pt,gt=r.cornerRadius(ot).padAngle(function(e){return e.padAngle||0}),vt=Ke().x(tt).y1(nt).y0(function(e){return(e.y||0)+(e.height||0)}).defined(st),xt=Ke().y(nt).x1(tt).x0(function(e){return(e.x||0)+(e.width||0)}).defined(st);function r(){var e,t,n,r,i,o,s,a,u,c,l,f,h,d,p,g,v,x,m,y,_,w,E=+at.apply(this,arguments),O=+ut.apply(this,arguments),b=ft.apply(this,arguments)-Me,L=ht.apply(this,arguments)-Me,S=ke(L-b),R=b<L;if(P=P||(e=pt()),O<E&&(t=O,O=E,E=t),O>T?S>De-T?(P.moveTo(O*C(b),O*M(b)),P.arc(0,0,O,b,L,!R),E>T&&(P.moveTo(E*C(L),E*M(L)),P.arc(0,0,E,L,b,R))):(r=t=b,i=n=L,s=o=S,h=(l=dt.apply(this,arguments)/2)>T&&(lt?+lt.apply(this,arguments):D(E*E+O*O)),w=_=a=Ce(ke(O-E)/2,+ct.apply(this,arguments)),h>T&&(f=Te(h/E*M(l)),h=Te(h/O*M(l)),(o-=2*f)>T?(r+=f*=R?1:-1,i-=f):(o=0,r=i=(b+L)/2),(s-=2*h)>T?(t+=h*=R?1:-1,n-=h):(s=0,t=n=(b+L)/2)),l=O*C(t),f=O*M(t),h=E*C(i),b=E*M(i),a>T&&(d=O*C(n),p=O*M(n),g=E*C(r),v=E*M(r),S<A)&&((L=function(e,t,n,r,i,o,s,a){var u=(a=a-o)*(n=n-e)-(s=s-i)*(r=r-t);if(!(u*u<T))return[e+(u=(s*(t-o)-a*(e-i))/u)*n,t+u*r]}(l,f,g,v,d,p,h,b))?(S=l-L[0],m=f-L[1],y=d-L[0],x=p-L[1],m=1/M((1<(S=(S*y+m*x)/(D(S*S+m*m)*D(y*y+x*x)))?0:S<-1?A:Math.acos(S))/2),y=D(L[0]*L[0]+L[1]*L[1]),_=Ce(a,(E-y)/(m-1)),w=Ce(a,(O-y)/(1+m))):_=w=0),s>T?w>T?(u=We(g,v,l,f,O,w,R),c=We(d,p,h,b,O,w,R),P.moveTo(u.cx+u.x01,u.cy+u.y01),w<a?P.arc(u.cx,u.cy,w,U(u.y01,u.x01),U(c.y01,c.x01),!R):(P.arc(u.cx,u.cy,w,U(u.y01,u.x01),U(u.y11,u.x11),!R),P.arc(0,0,O,U(u.cy+u.y11,u.cx+u.x11),U(c.cy+c.y11,c.cx+c.x11),!R),P.arc(c.cx,c.cy,w,U(c.y11,c.x11),U(c.y01,c.x01),!R))):(P.moveTo(l,f),P.arc(0,0,O,t,n,!R)):P.moveTo(l,f),E>T&&o>T?_>T?(u=We(h,b,d,p,E,-_,R),c=We(l,f,g,v,E,-_,R),P.lineTo(u.cx+u.x01,u.cy+u.y01),_<a?P.arc(u.cx,u.cy,_,U(u.y01,u.x01),U(c.y01,c.x01),!R):(P.arc(u.cx,u.cy,_,U(u.y01,u.x01),U(u.y11,u.x11),!R),P.arc(0,0,E,U(u.cy+u.y11,u.cx+u.x11),U(c.cy+c.y11,c.cx+c.x11),R),P.arc(c.cx,c.cy,_,U(c.y11,c.x11),U(c.y01,c.x01),!R))):P.arc(0,0,E,i,r,R):P.lineTo(h,b)):P.moveTo(0,0),P.closePath(),e)return P=null,e+""||null}Je().x(tt).y(nt).defined(st);var mt=f.pathTrail().x(tt).y(nt).defined(st).size(function(e){return e.width||e.height||1});f.pathRectangle().x(tt).y(nt).width(rt).height(it).cornerRadius(ot),f.pathRectangle().x(0).y(0).width(rt).height(it).cornerRadius(ot),function(t,n){let r=null,i=Fe(o);function o(){let e;if(r=r||(e=i()),t.apply(this,arguments).draw(r,+n.apply(this,arguments)),e)return r=null,e+""||null}return t="function"==typeof t?t:E(t||et),n="function"==typeof n?n:E(void 0===n?64:+n),o.type=function(e){return arguments.length?(t="function"==typeof e?e:E(e),o):t},o.size=function(e){return arguments.length?(n="function"==typeof e?e:E(+e),o):n},o.context=function(e){return arguments.length?(r=null==e?null:e,o):r},o}().type(function(e){return f.pathSymbols(e.shape||"circle")}).size(function(e){return null==e.size?64:e.size});o.from=function(e,t,n){var r,i;return void 0===t&&(t=1),void 0===n&&(n=1),!e||"transparent"===e?new o(0,0,0,0):e.id?new o(.5,1,1,+t*n):o.cache[e]||(r={r:255,g:255,b:255,a:255},i=new o((r={r:(i=c.color(e).rgb()).r,g:i.g,b:i.b,a:i.opacity}).r/255,r.g/255,r.b/255,r.a*t*n),o.cache[e]=i)},o.prototype[Symbol.iterator]=function(){var t,n,r,i;return N(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,7]),t=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.values),n=t.next(),e.label=1;case 1:return n.done?[3,4]:[4,n.value];case 2:e.sent(),e.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return r=e.sent(),r={error:r},[3,7];case 6:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(r)throw r.error}return[7];case 7:return[2]}})},Object.defineProperty(o.prototype,"rgba",{get:function(){return[this.values[0],this.values[1],this.values[2],this.values[3]]},set:function(e){this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2],this.values[3]=e[3]},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,0,{get:function(){return this.values[0]},set:function(e){this.values[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"r",{get:function(){return this.values[0]},set:function(e){this.values[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,1,{get:function(){return this.values[1]},set:function(e){this.values[1]=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"g",{get:function(){return this.values[1]},set:function(e){this.values[1]=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,2,{get:function(){return this.values[2]},set:function(e){this.values[2]=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"b",{get:function(){return this.values[2]},set:function(e){this.values[2]=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,3,{get:function(){return this.values[3]},set:function(e){this.values[3]=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"a",{get:function(){return this.values[3]},set:function(e){this.values[3]=e},enumerable:!1,configurable:!0}),o.cache={};var I=o;function o(e,t,n,r){void 0===r&&(r=1),this.values=[0,0,0,1],this.values[0]=e,this.values[1]=t,this.values[2]=n,this.values[3]=r}function yt(e,t){return e[0]*t[0]+e[1]*t[1]}var _t,wt,Et,Ot,bt,Lt,St,Rt,i={};function Ut(){return wt||(wt=1,_t=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}),_t}function kt(){return Ot||(Ot=1,Et=function(e,t,n){return e[0]=t,e[1]=n,e}),Et}function Bt(){return Lt||(Lt=1,bt=function(e,t){var n=t[0],r=t[1],n=n*n+r*r;0<n&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n);return e}),bt}function Ct(){return Rt||(Rt=1,St=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}),St}var Mt,Dt,Tt,At,Pt,It,qt=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0},l={create:function(){return[0,0]},clone:function(e){return[e[0],e[1]]},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},dot:yt},L=l.create(),Nt=l.create(),S=l.create(),Ft=l.create(),Gt=l.create(),Vt=l.create(),n=(s||(s=1,Mt=Ut(),Dt=kt(),Tt=Bt(),At=Ct(),Pt=yt,It=[0,0],i.computeMiter=function(e,t,n,r,i){return Mt(e,n,r),Tt(e,e),Dt(t,-e[1],e[0]),Dt(It,-n[1],n[0]),i/Pt(t,It)},i.normal=function(e,t){return Dt(e,-t[1],t[0]),e},i.direction=function(e,t,n){return At(e,t,n),Tt(e,e),e}),i),zt=n.computeMiter,Ht=n.normal,$t=n.direction;function Wt(e){if(!(this instanceof Wt))return new Wt(e);this.miterLimit=qt((e=e||{}).miterLimit,10),this.thickness=qt(e.thickness,1),this.join=e.join||"miter",this.cap=e.cap||"butt",this._normal=null,this._lastFlip=-1,this._started=!1}function Yt(e,t,n,r){l.scaleAndAdd(L,t,n,-r),e.push(l.clone(L)),l.scaleAndAdd(L,t,n,r),e.push(l.clone(L))}Wt.prototype.mapThickness=function(e,t,n){return this.thickness},Wt.prototype.build=function(e){var t={positions:[],cells:[]};if(!(e.length<=1)){var n=e.length;this._lastFlip=-1,this._started=!1,this._normal=null;for(var r=1,i=0;r<n;r++){var o=e[r-1],s=e[r],a=r<e.length-1?e[r+1]:null,u=this.mapThickness(s,r,e);i+=this._seg(t,i,o,s,a,u/2)}}return t},Wt.prototype._seg=function(e,t,n,r,i,o){var s=0,a=e.cells,e=e.positions,u="square"===this.cap,c="bevel"===this.join;return $t(S,r,n),this._normal||(this._normal=l.create(),Ht(this._normal,S)),this._started||(this._started=!0,u&&(l.scaleAndAdd(Nt,n,S,-o),n=Nt),Yt(e,n,this._normal,o)),a.push([t+0,t+1,t+2]),i?($t(Ft,i,r),n=zt(Gt,Vt,S,Ft,o),i=l.dot(Gt,this._normal)<0?-1:1,(c=c)||"miter"!==this.join||n/o>this.miterLimit&&(c=!0),c?(l.scaleAndAdd(L,r,this._normal,-o*i),e.push(l.clone(L)),l.scaleAndAdd(L,r,Vt,n*i),e.push(l.clone(L)),a.push(this._lastFlip!==-i?[t,t+2,t+3]:[t+2,t+1,t+3]),a.push([t+2,t+3,t+4]),Ht(L,Ft),l.copy(this._normal,L),l.scaleAndAdd(L,r,L,-o*i),e.push(l.clone(L)),s+=3):(Yt(e,r,Vt,n),a.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),i=-1,l.copy(this._normal,Vt),s+=2),this._lastFlip=i):(Ht(this._normal,S),u&&(l.scaleAndAdd(Nt,r,S,o),r=Nt),Yt(e,r,this._normal,o),a.push(1===this._lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3]),s+=2),s};var jt=F(Wt);function Qt(e,t,n){var r,i,o,s,a,u,c,l,f,h,d,p,g,v=null!=(v=t.strokeWidth)?v:1,x=null!=(x=t.strokeCap)?x:"butt",m=[],y=0,_=!1,w=!1,E=null==t.opacity?1:t.opacity,O=E*(null==t.fillOpacity?1:t.fillOpacity),b=E*(null==t.strokeOpacity?1:t.strokeOpacity),L=(n.z,n.triangles);if("transparent"===t.fill&&(O=0),t.fill&&0<O&&(_=!0,y=L?L.length/9:0),"transparent"===t.stroke&&(b=0),0<v&&t.stroke&&0<b)for(w=!0,g=jt({thickness:v,cap:x,join:"miter",miterLimit:1,closed:!!n.closed}),s=0;s<n.lines.length;s++)u=g.build(n.lines[s]),m.push(u),y+=u.cells.length;var S=new Float32Array(3*y*3),R=new Float32Array(3*y*4);if(_){for(o=I.from(t.fill),r=0,i=L.length;r<i;r+=3)S[r]=L[r],S[r+1]=L[r+1],S[r+2]=L[r+2];for(r=0,i=L.length/3;r<i;r++)R[4*r]=o[0],R[4*r+1]=o[1],R[4*r+2]=o[2],R[4*r+3]=O}if(w)for(o=I.from(t.stroke),r=_?L.length/3:0,s=0;s<m.length;s++)for(h=(u=m[s]).positions,d=u.cells,p=u.cells.length,a=0;a<p;a++)c=h[(f=d[a])[0]],l=h[f[1]],f=h[f[2]],S[3*r]=c[0],S[3*r+1]=c[1],S[3*r+2]=-.1,R[4*r]=o[0],R[4*r+1]=o[1],R[4*r+2]=o[2],R[4*r+3]=b,S[3*++r]=l[0],S[3*r+1]=l[1],S[3*r+2]=-.1,R[4*r]=o[0],R[4*r+1]=o[1],R[4*r+2]=o[2],R[4*r+3]=b,S[3*++r]=f[0],S[3*r+1]=f[1],S[3*r+2]=-.1,R[4*r]=o[0],R[4*r+1]=o[1],R[4*r+2]=o[2],R[4*r+3]=b,r++;return{triangles:S,colors:R,numTriangles:y}}var Zt="struct Uniforms {\n  resolution: vec2<f32>,\n  offset: vec2<f32>,\n}\n\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct VertexInput {\n  @location(0) position: vec3<f32>,\n  @location(1) fill_color: vec4<f32>,\n}\n\nstruct InstanceInput {\n  @location(2) center: vec2<f32>,\n}\n\nstruct VertexOutput {\n  @builtin(position) pos: vec4<f32>,\n  @location(0) uv: vec2<f32>,\n  @location(1) fill: vec4<f32>,\n}\n\n@vertex\nfn main_vertex(\n    model: VertexInput,\n    instance: InstanceInput\n) -> VertexOutput {\n    var output: VertexOutput;\n    var pos = model.position.xy + instance.center - uniforms.offset;\n    pos = pos / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, model.position.z + 0.5, 1.0);\n    output.uv = pos;\n    output.fill = model.fill_color;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    return in.fill;\n}\n",Xt="Arc",s={type:"arc",draw:function(e,t,n,r){var i=n.items;if(null!=i&&i.length)for(var o in i){var o=i[o],s=new x(e,Xt,this._uniforms.resolution,[r.x1,r.y1]),a=e.createShaderModule({code:Zt,label:"Arc Shader"}),u=new p(["float32x3","float32x4"],["float32x2"]),a=m.createRenderPipeline(Xt,e,a,n._format,u.getBuffers()),c=function(e,t){for(var e=function(e,t){return!e||e.arc?gt.context(e)(t):Ue(e,gt.context(null)(t),.1)}(e,t),n=Qt(0,t,e),r=[],i=0;i<n.numTriangles;i++)r.push(n.triangles[3*i],n.triangles[3*i+1],n.triangles[3*i+2]),r.push(n.colors[4*i],n.colors[4*i+1],n.colors[4*i+2],n.colors[4*i+3]);return Float32Array.from(r)}(t,o),u=c.length/u.getVertexLength(),c=s.createGeometryBuffer(c),l=s.createUniformBuffer(),l=m.createUniformBindGroup(Xt,e,a,l),o=function(e){var t=e.x,t=void 0===t?0:t,e=e.y,e=void 0===e?0:e;return Float32Array.from([t,e])}(o),s=s.createInstanceBuffer(o),o=m.createRenderPassDescriptor(Xt,this.clearColor(),this.depthTexture().createView());o.colorAttachments[0].view=t.getCurrentTexture().createView(),m.queue2(e,a,o,[u],[c,s],[l])}}};var Jt="Area",i={type:"area",draw:function(e,t,n,r){var i=n.items;if(null!=i&&i.length)for(var o in i){var o=i[o],s=(o.stroke="#fff",new x(e,Jt,this._uniforms.resolution,[r.x1,r.y1])),a=e.createShaderModule({code:Zt,label:Jt+" Shader"}),u=new p(["float32x3","float32x4"],["float32x2"]),a=m.createRenderPipeline(Jt,e,a,n._format,u.getBuffers()),o=function(e,t,n){for(var e=function(e,t){var n=t[0],r="trail"===(r=n.interpolate||"linear")?mt:("horizontal"===n.orient?xt:vt).curve(f.pathCurves(r,n.orient,n.tension));return!e||e.arc?r.context(e)(t):Ue(e,r.context(null)(t),.1)}(e,n),r=Qt(0,t,e),i=[],o=0;o<r.numTriangles;o++)i.push(r.triangles[3*o],r.triangles[3*o+1],r.triangles[3*o+2]),i.push(r.colors[4*o],r.colors[4*o+1],r.colors[4*o+2],r.colors[4*o+3]);return Float32Array.from(i)}(t,o,i),u=o.length/u.getVertexLength(),o=s.createGeometryBuffer(o),c=s.createUniformBuffer(),c=m.createUniformBindGroup(Jt,e,a,c),l=Float32Array.from([0,0]),s=s.createInstanceBuffer(l),l=m.createRenderPassDescriptor(Jt,this.clearColor(),this.depthTexture().createView());l.colorAttachments[0].view=t.getCurrentTexture().createView(),m.queue2(e,a,l,[u],[o,s],[c])}}};function Kt(e,t){return e.zindex-t.zindex||e.index-t.index}function en(e,t){var n,r,i=e.items;if(i&&i.length){e=function(e){if(!e.zdirty)return e.zitems;for(var t,n=e.items,r=[],i=0,o=n.length;i<o;++i)(t=n[i]).index=i,t.zindex&&r.push(t);return e.zdirty=!1,e.zitems=r.sort(Kt)}(e);if(e&&e.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=e}for(n=0,r=i.length;n<r;++n)t(i[n])}}var n={type:"group",draw:function(s,a,e,u){var c=this;en(e,function(e){var t,n=e.x||0,r=e.y||0,i=e.width||0,o=e.height||0;a._tx+=n,a._ty+=r,a._textContext.save(),a._textContext.translate(n,r),e.mark.clip&&(t=a._clip,a._clip=[a._origin[0]+a._tx,a._origin[1]+a._ty,a._origin[0]+a._tx+i,a._origin[1]+a._ty+o]),u&&u.translate(-n,-r),en(e,function(e){c.draw(s,a,e,u)}),u&&u.translate(n,r),(e.clip||e.bounds.clip)&&(a._clip=t),a._tx-=n,a._ty-=r,a._textContext.restore()})}},R="Line",tn={type:"line",draw:function(i,o,e,t){var s,a,n,r,u,c,l,f,h=this,d=e.items;null!=d&&d.length&&(t=new x(i,R,this._uniforms.resolution,[t.x1,t.y1]),r=i.createShaderModule({code:"struct Uniforms {\n    resolution: vec2<f32>,\n    offset: vec2<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n@group(1) @binding(0) var<storage, read> pos: array<vec2<f32>>;\n@group(1) @binding(1) var<storage, read> colors: array<vec4<f32>>;\n@group(1) @binding(2) var<storage, read> widths: array<f32>;\n\nstruct VertexInput {\n    @location(0) index: u32,\n};\n\n\nstruct VertexOutput {\n    @builtin(position) pos: vec4<f32>,\n    @location(0)  uv: vec2<f32>,\n    @location(1) fill: vec4<f32>,\n};\n\n@vertex\nfn main_vertex(@builtin(instance_index) index: u32, @builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\n    let start = pos[index];\n    let end = pos[index + 1];\n    let stroke_width = widths[index];\n    var color = colors[index];\n\n    // Calculate the direction vector of the line\n    let direction = normalize(end - start);\n    let angle = atan2(direction.y, direction.x);\n\n    // Calculate the normal vector\n    let normal = normalize(vec2<f32>(-direction.y, direction.x));\n\n    // Calculate the offset for width\n    let offset = normal * ((stroke_width) * 0.5);\n\n    // Calculate the four points of the line\n    var p1 = start - offset;\n    var p2 = start + offset;\n    var p3 = end - offset;\n    var p4 = end + offset;\n\n    var vertices = array(p1, p2, p3, p4, p2, p3);\n    var pos = vertices[vertexIndex];\n    pos = (pos - uniforms.offset) / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n\n    var out: VertexOutput;\n    out.pos = vec4<f32>(pos, 0.0, 1.0);\n    let rotatedUV = vertices[vertexIndex] + uniforms.offset;\n    var len = length(pos.xy);\n    out.uv = vec2<f32>(- pos.x / len, pos.y / len);\n    out.fill = color;\n    return out;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    return in.fill;\n}\n\nfn pos_length() -> u32 {\n    return arrayLength(&pos);\n}",label:R+" Shader"}),n=new p([],[]),s=m.createRenderPipeline(R,i,r,e._format,n.getBuffers()),a=m.createUniformBindGroup(R,i,s,t.createUniformBuffer()),r=function(e){for(var t=e,n=[],r=[],i=[],o=0;o<t.length;o++){var s=t[o],a=s.x,a=void 0===a?0:a,u=s.y,u=void 0===u?0:u,c=s.stroke,l=s.strokeOpacity,l=void 0===l?1:l,f=s.strokeWidth,f=void 0===f?1:f,s=s.opacity,s=void 0===s?1:s,c=I.from(c,s,l);n.push.apply(n,[a,u]),r.push.apply(r,v([],g(c.rgba),!1)),i.push.apply(i,[f])}return{pos:Float32Array.from(n),colors:Float32Array.from(r),widths:Float32Array.from(i)}}(d),e=t.createBuffer(R+" Point Position Buffer",r.pos,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),n=t.createBuffer(R+" Point Color Buffer",r.colors,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),r=t.createBuffer(R+" Point Width Buffer",r.widths,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST),u=m.createBindGroup(R,i,s,[e,n,r],null,1),c=Uint32Array.from([]),l=t.createInstanceBuffer(c),f=t.createFrameBuffer(c.byteLength),q(h,void 0,void 0,function(){var r=this;return N(this,function(e){switch(e.label){case 0:return[4,f.mapAsync(GPUMapMode.WRITE).then(function(){var e=new Float32Array(f.getMappedRange()),t=(e.set(c),i.createCommandEncoder()),e=(t.copyBufferToBuffer(f,e.byteOffset,l,c.byteOffset,c.byteLength),i.createCommandEncoder()),n=m.createRenderPassDescriptor(R,r.clearColor(),r.depthTexture().createView()),n=(n.colorAttachments[0].view=o.getCurrentTexture().createView(),e.beginRenderPass(n));n.setPipeline(s),n.setBindGroup(0,a),n.setBindGroup(1,u),n.draw(6,d.length-1),n.end(),f.unmap(),i.queue.submit([t.finish(),e.finish()])})];case 1:return e.sent(),[2]}})}))},pick:function(){return null}};var nn=Float32Array.from([0,0,0,1,1,0,1,0,0,1,1,1]),rn=(Float32Array.from([0,0,0,1,1,0,1,0,0,1,1,1]),"Rect");var on="Rule";var sn=32,an="Symbol";var un="Path";var cn,ln={arc:s,area:i,group:n,line:tn,rect:{type:"rect",draw:function(e,t,n,r){var i,o,s,a=n.items;null!=a&&a.length&&(r=new x(e,rn,this._uniforms.resolution,[r.x1,r.y1]),i=e.createShaderModule({code:"struct Uniforms {\n  resolution: vec2<f32>,\n  offset: vec2<f32>,\n};\n\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct VertexInput {\n  @location(0) position: vec2<f32>,\n}\n\nstruct InstanceInput {\n  @location(1) center: vec2<f32>,\n  @location(2) scale: vec2<f32>,\n  @location(3) fill_color: vec4<f32>,\n  @location(4) stroke_color: vec4<f32>,\n  @location(5) strokewidth: f32,\n  @location(6) corner_radii: vec4<f32>,\n}\n\nstruct VertexOutput {\n  @builtin(position) pos: vec4<f32>,\n  @location(0) uv: vec2<f32>,\n  @location(1) fill: vec4<f32>,\n  @location(2) stroke: vec4<f32>,\n  @location(3) strokewidth: f32,\n  @location(4) corner_radii: vec4<f32>,\n  @location(5) scale: vec2<f32>,\n}\n\n@vertex\nfn main_vertex(\n    model: VertexInput,\n    instance: InstanceInput\n) -> VertexOutput {\n    var output: VertexOutput;\n    var u = uniforms.resolution;\n    var scale = instance.scale + vec2<f32>(instance.strokewidth, instance.strokewidth);\n    var pos = model.position * scale + instance.center - uniforms.offset - vec2<f32>(instance.strokewidth, instance.strokewidth) / 2.0;\n    pos = pos / u;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, 0.0, 1.0);\n    output.uv = vec2<f32>(model.position.x, 1.0 - model.position.y);\n    output.fill = instance.fill_color;\n    output.stroke = instance.stroke_color;\n    output.strokewidth = instance.strokewidth;\n    output.corner_radii = instance.corner_radii;\n    output.scale = instance.scale;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    var col: vec4<f32> = in.fill;\n    let sw: vec2<f32> = vec2<f32>(in.strokewidth, in.strokewidth) / in.scale;\n    if in.uv.x < sw.x || in.uv.x > 1.0 - sw.x {\n        col = in.stroke;\n    }\n    if in.uv.y < sw.y || in.uv.y > 1.0 - sw.y {\n        col = in.stroke;\n    }\n    return col;\n}\n\nfn roundedBox(center: vec2<f32>, size: vec2<f32>, radius: vec4<f32>) -> f32 {\n    var rad = radius;\n    if center.x > 0.0 {\n        rad.x = radius.x;\n        rad.y = radius.y;\n    } else {\n        rad.x = radius.z;\n        rad.y = radius.w;\n    }\n    if center.y > 0.0 {\n        rad.x = rad.y;\n    }\n    var q = abs(center) - size + rad.x;\n    return min(max(q.x, q.y), 0.0) + length(max(q, vec2<f32>(0.0))) - rad.x;\n}\n",label:rn+" Shader"}),o=new p(["float32x2"],["float32x2","float32x2","float32x4","float32x4","float32","float32x4"]),i=m.createRenderPipeline(rn,e,i,n._format,o.getBuffers()),n=r.createGeometryBuffer(nn),o=r.createUniformBuffer(),o=m.createUniformBindGroup(rn,e,i,o),s=function(e){return Float32Array.from(e.flatMap(function(e){var t=e.x,t=void 0===t?0:t,n=e.y,n=void 0===n?0:n,r=e.width,r=void 0===r?0:r,i=e.height,i=void 0===i?0:i,o=e.opacity,o=void 0===o?1:o,s=e.fill,a=e.fillOpacity,u=e.stroke,u=void 0===u?null:u,c=e.strokeOpacity,c=void 0===c?1:c,l=e.strokeWidth,l=void 0===l?null:l,f=e.cornerRadius,f=void 0===f?0:f,h=e.cornerRadiusBottomLeft,h=void 0===h?null:h,d=e.cornerRadiusBottomRight,d=void 0===d?null:d,p=e.cornerRadiusTopRight,p=void 0===p?null:p,e=e.cornerRadiusTopLeft,e=void 0===e?null:e,s=I.from(s,o,void 0===a?1:a),a=I.from(u,o,c),o=u?null!=l?l:1:null!=l?l:0,c=[null!=p?p:f,null!=d?d:f,null!=h?h:f,null!=e?e:f];return v(v(v(v([t,n,r,i],g(s.rgba),!1),g(a.rgba),!1),[o],!1),g(c),!1)}))}(a),r=r.createInstanceBuffer(s),(s=m.createRenderPassDescriptor(rn,this.clearColor(),this.depthTexture().createView())).colorAttachments[0].view=t.getCurrentTexture().createView(),m.queue2(e,i,s,[6,a.length],[n,r],[o]))}},rule:{type:"rule",draw:function(e,t,n,r){var i,o,s,a=n.items;null!=a&&a.length&&(o=[this._uniforms.resolution[0],this._uniforms.resolution[1]],o=new x(e,on,o,[r.x1,r.y1]),r=e.createShaderModule({code:"struct Uniforms {\n    resolution: vec2<f32>,\n    offset: vec2<f32>,\n}\n\n@group(0) @binding(0) var<uniform> uniforms: Uniforms;\n\nstruct VertexInput {\n    @location(0) position: vec2<f32>,\n    @location(1) center: vec2<f32>,\n    @location(2) scale: vec2<f32>,\n    @location(3) stroke_color: vec4<f32>,\n}\n\nstruct VertexOutput {\n    @builtin(position) pos: vec4<f32>,\n    @location(1) stroke: vec4<f32>,\n}\n\n@vertex\nfn main_vertex(in: VertexInput) -> VertexOutput {\n    var output : VertexOutput;\n    var u = uniforms.resolution;\n    var axis_offsets = calculateAxisWidthOffsets(in.scale);\n    var pos = in.position * in.scale  + in.center - uniforms.offset - axis_offsets;\n    pos = pos / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, 0.0, 1.0);\n    output.stroke = in.stroke_color;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    return in.stroke;\n}\n\nfn calculateAxisWidthOffsets(inScale: vec2<f32>) -> vec2<f32> {\n    var x_width_offset = inScale.x;\n    var y_width_offset = inScale.y;\n\n    // one of them should be exactly 1.0 as its either a y or a x axis.\n    if (x_width_offset > 1.0) {\n        x_width_offset = 0.0;\n    }\n    if (y_width_offset > 1.0) {\n        y_width_offset = 0.0;\n    }\n    return vec2<f32>(x_width_offset / 2.0, y_width_offset / 2.0);\n}",label:on+" Shader"}),i=new p(["float32x2"],["float32x2","float32x2","float32x4"]),r=m.createRenderPipeline(on,e,r,n._format,i.getBuffers()),n=o.createGeometryBuffer(nn),i=o.createUniformBuffer(),i=m.createUniformBindGroup(on,e,r,i),s=function(e){return Float32Array.from(e.flatMap(function(e){var t=e.x,t=void 0===t?0:t,n=e.y,n=void 0===n?0:n,r=e.x2,i=e.y2,o=e.stroke,s=e.strokeWidth,s=void 0===s?1:s,a=e.opacity,a=void 0===a?1:a,e=e.strokeOpacity,e=void 0===e?1:e,u=(null!=r||(r=t),null!=i||(i=n),Math.abs(r-t)),c=Math.abs(i-n),o=I.from(o,a,e);return v([Math.min(t,r),Math.min(n,i),u||s,c||s],g(o.rgba),!1)}))}(a),o=o.createInstanceBuffer(s),(s=m.createRenderPassDescriptor(on,this.clearColor(),this.depthTexture().createView())).colorAttachments[0].view=t.getCurrentTexture().createView(),m.queue2(e,r,s,[6,a.length],[n,o],[i]))}},symbol:{type:"symbol",draw:function(e,t,n,r){var i,o,s,a=n.items;null!=a&&a.length&&(r=new x(e,an,this._uniforms.resolution,[r.x1,r.y1]),i=e.createShaderModule({code:"struct Uniforms {\n  resolution: vec2<f32>,\n  offset: vec2<f32>,\n}\n\n@group(0) @binding(0) var<uniform> uniforms : Uniforms;\n\nstruct VertexInput {\n  @location(0) position: vec2<f32>,\n}\n\nstruct InstanceInput {\n  @location(1) center: vec2<f32>,\n  @location(2) radius: f32,\n  @location(3) fill_color: vec4<f32>,\n  @location(4) stroke_color: vec4<f32>,\n  @location(5) stroke_width: f32,\n}\n\nstruct VertexOutput {\n  @builtin(position) pos: vec4<f32>,\n  @location(0) uv: vec2<f32>,\n  @location(1) fill: vec4<f32>,\n  @location(2) stroke_color: vec4<f32>,\n  @location(3) stroke_width_percent: f32,\n}\n\nconst smooth_width = 0.05;\n\n@vertex\nfn main_vertex(\n    model: VertexInput,\n    instance: InstanceInput\n) -> VertexOutput {\n    var output: VertexOutput;\n    var stroke_width = instance.stroke_width / 2.0;\n    var radius_with_stroke = instance.radius + stroke_width;\n    var smooth_adjusted_radius = radius_with_stroke * 2.0 / (2.0 - smooth_width);\n    var pos = vec2<f32>(model.position * smooth_adjusted_radius) + instance.center - uniforms.offset;\n    pos = pos / uniforms.resolution;\n    pos.y = 1.0 - pos.y;\n    pos = pos * 2.0 - 1.0;\n    output.pos = vec4<f32>(pos, 0.0, 1.0);\n    output.uv = model.position / 2.0 + vec2<f32>(0.5, 0.5);\n    output.fill = instance.fill_color;\n    output.stroke_color = instance.stroke_color;\n    output.stroke_width_percent = stroke_width / radius_with_stroke;\n    return output;\n}\n\n@fragment\nfn main_fragment(in: VertexOutput) -> @location(0) vec4<f32> {\n    let distance = distance(vec2<f32>(0.5, 0.5), in.uv);\n    let smoothOuter: f32 = smoothstep(0.0, smooth_width, 0.5 - distance);\n    let smoothInner: f32 = 1.0 - smoothstep(in.stroke_width_percent - smooth_width / 2.0, in.stroke_width_percent + smooth_width / 2.0, 0.5 - distance);\n    return mix(vec4<f32>(in.fill.rgb, in.fill.a * smoothOuter), vec4<f32>(in.stroke_color.rgb, in.stroke_color.a * smoothOuter), smoothInner);\n}\n\nfn binaryIndicator(value: f32, edge0: f32, edge1: f32) -> f32 {\n    if edge0 == edge1 {\n        return 0.0;\n    }\n    let t = saturate((value - edge0) / (edge1 - edge0));\n    return ceil(t);\n}",label:an+" Shader"}),o=new p(["float32x2"],["float32x2","float32","float32x4","float32x4","float32"]),i=m.createRenderPipeline(an,e,i,n._format,o.getBuffers()),n=r.createGeometryBuffer(new Float32Array(Array.from({length:sn},function(e,t){var n=(t+1)%sn,t=t?2*Math.PI/sn*t:0,n=n?2*Math.PI/sn*n:0;return[Math.cos(t),Math.sin(t),0,0,Math.cos(n),Math.sin(n)]}).flat())),o=r.createUniformBuffer(),o=m.createUniformBindGroup(an,e,i,o),s=function(e){return Float32Array.from(e.flatMap(function(e){var t=e.x,t=void 0===t?0:t,n=e.y,n=void 0===n?0:n,r=e.size,i=e.fill,o=e.stroke,s=e.strokeWidth,a=e.opacity,a=void 0===a?1:a,u=e.fillOpacity,e=e.strokeOpacity,e=void 0===e?1:e,i=I.from(i,a,void 0===u?1:u),u=I.from(o,a,e),a=o?null!=s?s:1:0;return v(v(v([t,n,Math.sqrt(r)/2],g(i.rgba),!1),g(u.rgba),!1),[a],!1)}))}(a),r=r.createInstanceBuffer(s),(s=m.createRenderPassDescriptor(an,this.clearColor(),this.depthTexture().createView())).colorAttachments[0].view=t.getCurrentTexture().createView(),m.queue2(e,i,s,[3*sn,a.length],[n,r],[o]))},pick:function(){return null}},text:{type:"text",draw:function(e,t,n,r){f.Marks.text.draw(this._textContext,n,r)}},path:{type:"path",draw:function(e,t,n,r){var i=n.items;if(null!=i&&i.length)for(var o in i){var o=i[o],s=(t._tx+=o.x||0,t._ty+=o.y||0,new x(e,un,this._uniforms.resolution,[r.x1,r.y1])),a=e.createShaderModule({code:Zt,label:un+" Shader"}),u=new p(["float32x3","float32x4"],["float32x2"]),a=m.createRenderPipeline(un,e,a,n._format,u.getBuffers()),c=function(e,t){for(var n=t.path,e=Ue(e,n),r=Qt(0,t,e),i=[],o=0;o<r.numTriangles;o++)i.push(r.triangles[3*o],r.triangles[3*o+1],r.triangles[3*o+2]),i.push(r.colors[4*o],r.colors[4*o+1],r.colors[4*o+2],r.colors[4*o+3]);return Float32Array.from(i)}(t,o),u=c.length/u.getVertexLength(),c=s.createGeometryBuffer(c),l=s.createUniformBuffer(),l=m.createUniformBindGroup(un,e,a,l),f=function(e){return e.x,e.y,Float32Array.from([0,0])}(o),s=s.createInstanceBuffer(f),f=m.createRenderPassDescriptor(un,this.clearColor(),this.depthTexture().createView());f.colorAttachments[0].view=t.getCurrentTexture().createView(),m.queue2(e,a,f,[u,i.length],[c,s],[l]),t._tx-=o.x||0,t._ty-=o.y||0}}}};function fn(e,t,n){return e.fields=t||[],e.fname=n,e}const hn=t=>function(e){return e[t]},dn=n=>{const r=n.length;return function(t){for(let e=0;e<r;++e)t=t[n[e]];return t}};function pn(e){throw Error(e)}function gn(e){f.Renderer.call(this,e),this._options={},this._redraw=!1,this._dirty=new f.Bounds,this._tempb=new f.Bounds}s=1===(i=function(e){const t=[],n=e.length;let r=null,i=0,o="",s,a,u;function c(){t.push(o+e.substring(s,a)),o="",s=a+1}for(e+="",s=a=0;a<n;++a)"\\"===(u=e[a])?(o+=e.substring(s,a++),s=a):u===r?(c(),r=null,i=-1):r||(s===i&&'"'===u||s===i&&"'"===u?(s=a+1,r=u):"."!==u||i?"["===u?(a>s&&c(),i=s=a+1):"]"===u&&(i||pn("Access path missing open bracket: "+e),0<i&&c(),i=0,s=a+1):a>s?c():s=a+1);return i&&pn("Access path missing closing bracket: "+e),r&&pn("Access path missing closing quote: "+e),a>s&&(a++,c()),t}(s="id")).length?i[0]:s,fn((vn&&vn.get||function(e){return 1===e.length?hn(e[0]):dn(e)})(i),[s],cn||s),fn(e=>e,[],"identity"),fn(()=>0,[],"zero"),fn(()=>1,[],"one"),fn(()=>!0,[],"true"),fn(()=>!1,[],"false");var vn,xn=f.Renderer.prototype;n=gn,tn=f.Renderer,vn={initialize:function(e,t,n,r){return this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("webgpu"),this._textCanvas=document.createElement("canvas"),this._textContext=this._textCanvas.getContext("2d"),e&&(e.setAttribute("style","position: relative;"),this._canvas.setAttribute("class","marks"),this._textCanvas.setAttribute("class","textCanvas"),f.domClear(e,0),e.appendChild(this._canvas),e.appendChild(this._textCanvas)),this._canvas._textCanvas=this._textCanvas,this._ctx._textContext=this._textContext,(this._ctx._renderer=this)._bgcolor="#ffffff",this._uniforms={resolution:[t,n],origin:r,dpi:window.devicePixelRatio||1},this._ctx._pathCache={},xn.initialize.call(this,e,t,n,r)},resize:function(e,t,n){var r,i,o,s,a,u,c,l;return xn.resize.call(this,e,t,n),r=this._canvas,i=this._ctx,o=this._width,s=this._height,a=this._origin,u=this._textCanvas,c=this._textContext,l="undefined"!=typeof HTMLElement&&r instanceof HTMLElement&&null!=r.parentNode?window.devicePixelRatio:1,r.width=o*l,r.height=s*l,u.width=o*l,u.height=s*l,c.pixelRatio=l,c.setTransform(l,0,0,l,l*a[0],l*a[1]),1!==l&&(r.style.width=o+"px",r.style.height=s+"px"),i._lineWidth=l,i._viewport={x:0,y:0,width:o,height:s,minDepth:0,maxDepth:1},i._origin=a,i._ratio=l,i._clip=[0,0,r.width/i._ratio,r.height/i._ratio],1!==(window.devicePixelRatio||1)&&(this._textCanvas.style.width=e+"px",this._textCanvas.style.height=t+"px"),this._uniforms={resolution:[e,t],origin:n,dpi:window.devicePixelRatio||1},this._redraw=!0,this},canvas:function(){return this._canvas},textCanvas:function(){return this._textCanvas},context:function(){return this._ctx||null},textContext:function(){return this._textContext||null},device:function(){return this._device||null},dirty:function(e){for(var t=this._tempb.clear().union(e.bounds),n=e.mark.group;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render:function(i){var e=this,t=this._origin,n=this._width,r=this._height,o=(t=t,n=n,r=r,(new f.Bounds).set(0,0,n,r).translate(-t[0],-t[1])),n=this.context(),r=(n._tx=0,n._ty=0,this.device());return this._textContext.save(),this._textContext.setTransform(1,0,0,1,0,0),this._textContext.clearRect(0,0,this._textCanvas.width+300,this._textCanvas.height+300),this._textContext.restore(),r&&n?this.draw(r,n,i,o):q(e,void 0,void 0,function(){var t,n,r;return N(this,function(e){switch(e.label){case 0:return[4,navigator.gpu.requestAdapter()];case 1:return[4,(t=e.sent()).requestDevice()];case 2:return n=e.sent(),this._adapter=t,this._device=n,this._ctx=this._canvas.getContext("webgpu"),r=navigator.gpu.getPreferredCanvasFormat(),this._prefferedFormat=r,this._ctx.configure({device:n,format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:"premultiplied"}),this.draw(n,this._ctx,i,o),[2]}})}),this},frame:function(){return this._lastScene&&this._render(this._lastScene,[]),this},draw:function(e,t,n,r){var i=ln[n.marktype];null==i?console.error("Unknown mark type: '".concat(n.marktype,"'")):(n._format=this.prefferedFormat(),i.draw.call(this,e,t,n,r))},clear:function(){},depthTexture:function(){return null!=this._depthTexture&&this._depthTexture.device===this._device&&this._depthTexture.width===this.canvas().width&&this._depthTexture.height===this.canvas().height||(this._depthTexture=this.device().createTexture({size:[this.canvas().width,this.canvas().height,1],format:"depth24plus",dimension:"2d",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this._depthTexture.device=this._device),this._depthTexture},clearColor:function(){return this._bgcolor?c.color(this._bgcolor):{r:1,g:1,b:1,a:1}},prefferedFormat:function(){return null!=this._prefferedFormat?this._prefferedFormat:null}},tn=n.prototype=Object.create(tn.prototype),Object.defineProperty(tn,"constructor",{value:n,writable:!0,enumerable:!0,configurable:!0}),function(i){for(let e,t,n=1,r=arguments.length;n<r;++n)for(t in e=arguments[n])i[t]=e[t]}(tn,vn),f.CanvasHandler.prototype.context=function(){return this._canvas.getContext("2d")||this._canvas._textCanvas.getContext("2d")},f.renderModule("webgpu",{handler:f.CanvasHandler,renderer:gn}),u.WebGPURenderer=gn});